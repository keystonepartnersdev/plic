# PLIC ë³´ì•ˆ ì •ì±… (SECURITY)

## ğŸ“‹ ë¬¸ì„œ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë¬¸ì„œëª… | PLIC Security Policy |
| ë²„ì „ | 1.1 |
| ì‘ì„±ì¼ | 2025-01-06 |
| ìˆ˜ì •ì¼ | 2025-01-06 |
| ì‘ì„±ì | PLIC ë³´ì•ˆíŒ€ |
| ìƒíƒœ | **Approved** |
| ì—­í•  | **ë³´ì•ˆ ì •ì±… SSOT** |

---

## ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© | ì‘ì„±ì |
|------|------|-----------|--------|
| 1.0 | 2025-01-06 | ì´ˆì•ˆ ì‘ì„± | PLIC ë³´ì•ˆíŒ€ |
| 1.1 | 2025-01-06 | **CTO ë¦¬ë·° ë°˜ì˜**: Hybrid ì¸ì¦(ì¿ í‚¤/CSRF/CORS), admin_audit_logs ë§¤í•‘, Geo Blocking ì •ì±…, ì›¹í›… ì„œëª… ê²€ì¦, ë¡œê·¸ ë§ˆìŠ¤í‚¹ í•„ë“œ ëª…ì‹œ, Secrets Manager ì •ì±…, Runbook ë§í¬ | PLIC ë³´ì•ˆíŒ€ |

---

## 1. ë³´ì•ˆ ê°œìš”

### 1.1 ë³´ì•ˆ ì›ì¹™

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **ìµœì†Œ ê¶Œí•œ** | í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬ |
| **ì‹¬ì¸µ ë°©ì–´** | ë‹¤ì¤‘ ë³´ì•ˆ ê³„ì¸µ êµ¬ì„± |
| **ì•”í˜¸í™” ìš°ì„ ** | ë¯¼ê° ë°ì´í„°ëŠ” í•­ìƒ ì•”í˜¸í™” |
| **ê°ì‚¬ ì¶”ì ** | ëª¨ë“  ì¤‘ìš” ì‘ì—… ë¡œê¹… |
| **ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸** | ëª¨ë“  ìš”ì²­ ê²€ì¦ |

### 1.2 ê·œì • ì¤€ìˆ˜

| ê·œì • | ì ìš© ë²”ìœ„ | ë¹„ê³  |
|------|----------|------|
| **PCI-DSS SAQ-A** | ì¹´ë“œ ë°ì´í„° ì²˜ë¦¬ | PG ìœ„íƒ |
| **ê°œì¸ì •ë³´ë³´í˜¸ë²•** | ê°œì¸ì •ë³´ ì²˜ë¦¬ | êµ­ë‚´ë²• |
| **ì „ìê¸ˆìœµê±°ë˜ë²•** | ì „ìê¸ˆìœµ ì„œë¹„ìŠ¤ | êµ­ë‚´ë²• |
| **ì •ë³´í†µì‹ ë§ë²•** | ì •ë³´í†µì‹  ì„œë¹„ìŠ¤ | êµ­ë‚´ë²• |

### 1.3 ë³´ì•ˆ ë“±ê¸‰

| ë“±ê¸‰ | ë°ì´í„° ìœ í˜• | ë³´í˜¸ ìˆ˜ì¤€ |
|------|-----------|----------|
| **ê·¹ë¹„** | billingKey, CI, ë¹„ë°€ë²ˆí˜¸ | ì•”í˜¸í™” + ì ‘ê·¼ ì œí•œ |
| **ëŒ€ì™¸ë¹„** | ê³„ì¢Œë²ˆí˜¸, ì¹´ë“œì •ë³´ | ì•”í˜¸í™” |
| **ë‚´ë¶€ìš©** | ê±°ë˜ë‚´ì—­, íšŒì›ì •ë³´ | ì ‘ê·¼ ì œì–´ |
| **ê³µê°œ** | ì„œë¹„ìŠ¤ ì•ˆë‚´ | ì œí•œ ì—†ìŒ |

---

## 2. ë°ì´í„° ì•”í˜¸í™”

### 2.1 ì•”í˜¸í™” ì •ì±…

| ë°ì´í„° | ì•”í˜¸í™” ë°©ì‹ | í‚¤ ê´€ë¦¬ | ë¹„ê³  |
|--------|-----------|--------|------|
| **billingKey** | AES-256-GCM | AWS KMS | PG ë°œê¸‰ í† í° |
| **ê³„ì¢Œë²ˆí˜¸** | AES-256-GCM | AWS KMS | - |
| **ì˜ˆê¸ˆì£¼ëª…** | AES-256-GCM | AWS KMS | - |
| **CI** | SHA-256 | - | ë‹¨ë°©í–¥ í•´ì‹œ |
| **ë¹„ë°€ë²ˆí˜¸** | bcrypt | - | cost=12 |
| **íœ´ëŒ€í°ë²ˆí˜¸** | AES-256-GCM | AWS KMS | ê²€ìƒ‰ìš© í•´ì‹œ ë³„ë„ |

### 2.2 AWS KMS í‚¤ ê´€ë¦¬

**í‚¤ êµ¬ì„±**:
```
plic-prod-data-key       # ë°ì´í„° ì•”í˜¸í™” ë§ˆìŠ¤í„° í‚¤
â”œâ”€â”€ billingKey ì•”í˜¸í™”
â”œâ”€â”€ accountNumber ì•”í˜¸í™”
â””â”€â”€ accountHolderName ì•”í˜¸í™”

plic-prod-search-key     # ê²€ìƒ‰ìš© í•´ì‹œ í‚¤
â””â”€â”€ íœ´ëŒ€í°ë²ˆí˜¸ ê²€ìƒ‰ í•´ì‹œ
```

**í‚¤ ì •ì±…**:
- ìë™ í‚¤ ìˆœí™˜: 1ë…„
- ì‚­ì œ ëŒ€ê¸° ê¸°ê°„: 30ì¼
- ì ‘ê·¼ ê¶Œí•œ: ECS Task Roleë§Œ

### 2.3 ì•”í˜¸í™” êµ¬í˜„

```typescript
// encryption.service.ts
import { KMSClient, DecryptCommand, EncryptCommand } from '@aws-sdk/client-kms';

export class EncryptionService {
  private kmsClient = new KMSClient({ region: 'ap-northeast-2' });
  private keyId = process.env.KMS_KEY_ID;

  async encrypt(plaintext: string): Promise<string> {
    const command = new EncryptCommand({
      KeyId: this.keyId,
      Plaintext: Buffer.from(plaintext),
    });
    const response = await this.kmsClient.send(command);
    return Buffer.from(response.CiphertextBlob!).toString('base64');
  }

  async decrypt(ciphertext: string): Promise<string> {
    const command = new DecryptCommand({
      CiphertextBlob: Buffer.from(ciphertext, 'base64'),
    });
    const response = await this.kmsClient.send(command);
    return Buffer.from(response.Plaintext!).toString('utf-8');
  }
}
```

### 2.4 ë¹„ë°€ë²ˆí˜¸ í•´ì‹±

```typescript
import * as bcrypt from 'bcrypt';

const SALT_ROUNDS = 12;

// í•´ì‹±
async function hashPassword(password: string): Promise<string> {
  return bcrypt.hash(password, SALT_ROUNDS);
}

// ê²€ì¦
async function verifyPassword(password: string, hash: string): Promise<boolean> {
  return bcrypt.compare(password, hash);
}
```

---

## 3. ì „ì†¡ ë³´ì•ˆ

### 3.1 TLS ì„¤ì •

| í•­ëª© | ì„¤ì • | ë¹„ê³  |
|------|------|------|
| **TLS ë²„ì „** | 1.2 ì´ìƒ (1.3 ê¶Œì¥) | TLS 1.0/1.1 ë¹„í™œì„±í™” |
| **ì•”í˜¸ ìŠ¤ìœ„íŠ¸** | ECDHE-RSA-AES256-GCM-SHA384 | ê°•ë ¥í•œ ì•”í˜¸ë§Œ |
| **ì¸ì¦ì„œ** | ACM (AWS Certificate Manager) | ìë™ ê°±ì‹  |
| **HSTS** | max-age=31536000 | 1ë…„ |

### 3.2 ALB ì„¤ì •

```yaml
# Security Policy: ELBSecurityPolicy-TLS13-1-2-2021-06

Listeners:
  - Port: 443
    Protocol: HTTPS
    SSLPolicy: ELBSecurityPolicy-TLS13-1-2-2021-06
    Certificates:
      - CertificateArn: arn:aws:acm:ap-northeast-2:xxx:certificate/xxx

  # HTTP â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸
  - Port: 80
    Protocol: HTTP
    DefaultActions:
      - Type: redirect
        RedirectConfig:
          Protocol: HTTPS
          Port: '443'
          StatusCode: HTTP_301
```

### 3.3 ë‚´ë¶€ í†µì‹ 

| êµ¬ê°„ | ë³´í˜¸ ë°©ì‹ | ë¹„ê³  |
|------|----------|------|
| ALB â†’ ECS | HTTPS (ë‚´ë¶€) | VPC ë‚´ë¶€ |
| ECS â†’ RDS | TLS | rds.force_ssl=1 |
| ECS â†’ ElastiCache | TLS | in-transit ì•”í˜¸í™” |
| ECS â†’ SQS | HTTPS | AWS SDK ê¸°ë³¸ |

---

## 4. ì¸ì¦/ì¸ê°€

### 4.1 JWT í† í°

**í† í° êµ¬ì¡°**:
```typescript
// Access Token
{
  "sub": "user_123",           // ì‚¬ìš©ì ID
  "type": "access",
  "iat": 1704499200,           // ë°œê¸‰ ì‹œê°„
  "exp": 1704502800,           // ë§Œë£Œ ì‹œê°„ (1ì‹œê°„)
}

// Refresh Token
{
  "sub": "user_123",
  "type": "refresh",
  "jti": "refresh_token_id",   // í† í° ê³ ìœ  ID (íê¸°ìš©)
  "iat": 1704499200,
  "exp": 1705104000,           // ë§Œë£Œ ì‹œê°„ (7ì¼)
}
```

**í† í° ì •ì±…**:
| í† í° | ìœ íš¨ ê¸°ê°„ | ì €ì¥ ìœ„ì¹˜ | ê°±ì‹  |
|------|----------|----------|------|
| Access Token | 1ì‹œê°„ | ë©”ëª¨ë¦¬ | Refreshë¡œ ê°±ì‹  |
| Refresh Token | 7ì¼ | Secure Cookie | ì¬ë¡œê·¸ì¸ |

### 4.2 ì„¸ì…˜ ê´€ë¦¬

```typescript
// ë™ì‹œ ì„¸ì…˜ ì œí•œ
const MAX_SESSIONS = 3;

// ì„¸ì…˜ ê²€ì¦
async function validateSession(userId: string, sessionId: string): Promise<boolean> {
  const sessions = await redis.smembers(`sessions:${userId}`);
  return sessions.includes(sessionId);
}

// ì„¸ì…˜ ìƒì„± (ì˜¤ë˜ëœ ì„¸ì…˜ ì œê±°)
async function createSession(userId: string, sessionId: string): Promise<void> {
  const key = `sessions:${userId}`;
  await redis.sadd(key, sessionId);
  
  const sessions = await redis.smembers(key);
  if (sessions.length > MAX_SESSIONS) {
    const oldest = sessions[0];
    await redis.srem(key, oldest);
  }
}
```

### 4.3 ê¶Œí•œ ê´€ë¦¬ (Admin)

| ì—­í•  | ê¶Œí•œ | ë¹„ê³  |
|------|------|------|
| **SUPER_ADMIN** | ì „ì²´ ê¶Œí•œ | ì‹œìŠ¤í…œ ì„¤ì • í¬í•¨ |
| **ADMIN** | íšŒì›/ê±°ë˜ ê´€ë¦¬ | - |
| **OPERATOR** | ì¡°íšŒ + ì œí•œì  ì²˜ë¦¬ | ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹ |
| **VIEWER** | ì¡°íšŒë§Œ | - |

### 4.4 Web/Hybrid ì¸ì¦ âš ï¸ (v1.1 ì¶”ê°€)

> âš ï¸ **PLICì€ Hybrid App (WebView)** í™˜ê²½ì„ ì§€ì›í•©ë‹ˆë‹¤.

**ì¿ í‚¤ ì •ì±…**:
| í•­ëª© | ì„¤ì • | ë¹„ê³  |
|------|------|------|
| **Domain** | `.plic.co.kr` | ì„œë¸Œë„ë©”ì¸ í¬í•¨ |
| **SameSite** | `Lax` | CSRF ê¸°ë³¸ ë°©ì–´ |
| **Secure** | `true` | HTTPSë§Œ ì „ì†¡ |
| **HttpOnly** | `true` | JS ì ‘ê·¼ ì°¨ë‹¨ |
| **Path** | `/` | ì „ì²´ ê²½ë¡œ |

**CSRF ë°©ì–´**:
```typescript
// CSRF í† í° ê²€ì¦ (ìƒíƒœ ë³€ê²½ ìš”ì²­)
// 1. ì¿ í‚¤: csrf_token (HttpOnly=false, JSì—ì„œ ì½ê¸° ê°€ëŠ¥)
// 2. í—¤ë”: X-CSRF-Token (ìš”ì²­ ì‹œ í¬í•¨)
// 3. ì„œë²„: ì¿ í‚¤ ê°’ê³¼ í—¤ë” ê°’ ì¼ì¹˜ ê²€ì¦

const csrfMiddleware = (req, res, next) => {
  if (['POST', 'PUT', 'PATCH', 'DELETE'].includes(req.method)) {
    const cookieToken = req.cookies['csrf_token'];
    const headerToken = req.headers['x-csrf-token'];
    
    if (!cookieToken || cookieToken !== headerToken) {
      return res.status(403).json({ error: 'CSRF_TOKEN_MISMATCH' });
    }
  }
  next();
};
```

**CORS ì •ì±…**:
```typescript
const corsOptions = {
  origin: [
    'https://plic.co.kr',
    'https://www.plic.co.kr',
    'https://app.plic.co.kr',
    // ê°œë°œ í™˜ê²½
    process.env.NODE_ENV === 'development' && 'http://localhost:3000',
  ].filter(Boolean),
  credentials: true,  // ì¿ í‚¤ í¬í•¨ í—ˆìš©
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],
  allowedHeaders: [
    'Content-Type',
    'Authorization',
    'X-Request-Id',
    'X-CSRF-Token',
    'Idempotency-Key',
    'If-Match',
  ],
};
```

**WebView íŠ¹ìˆ˜ ì²˜ë¦¬**:
| í”Œë«í¼ | ì¿ í‚¤ ì²˜ë¦¬ | ë¹„ê³  |
|--------|----------|------|
| iOS WKWebView | `WKWebsiteDataStore` ê³µìœ  | ë„ë©”ì¸ë³„ ì¿ í‚¤ ê²©ë¦¬ |
| Android WebView | `CookieManager` ë™ê¸°í™” | `setAcceptThirdPartyCookies(true)` |

---

## 5. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

### 5.1 VPC êµ¬ì„±

```
VPC (10.0.0.0/16)
â”œâ”€â”€ Public Subnet (10.0.1.0/24, 10.0.2.0/24)
â”‚   â””â”€â”€ ALB
â”‚
â”œâ”€â”€ Private Subnet (10.0.10.0/24, 10.0.11.0/24)
â”‚   â””â”€â”€ ECS Tasks (API, Worker)
â”‚
â””â”€â”€ Database Subnet (10.0.20.0/24, 10.0.21.0/24)
    â”œâ”€â”€ RDS
    â””â”€â”€ ElastiCache
```

### 5.2 Security Group

**ALB Security Group**:
```
Inbound:
  - 443/tcp from 0.0.0.0/0     # HTTPS
  - 80/tcp from 0.0.0.0/0      # HTTP (ë¦¬ë‹¤ì´ë ‰íŠ¸)

Outbound:
  - 3000/tcp to ECS-SG         # ECSë¡œ ì „ë‹¬
```

**ECS Security Group**:
```
Inbound:
  - 3000/tcp from ALB-SG       # ALBì—ì„œë§Œ

Outbound:
  - 5432/tcp to RDS-SG         # PostgreSQL
  - 6379/tcp to Redis-SG       # Redis
  - 443/tcp to 0.0.0.0/0       # ì™¸ë¶€ API (PG, ì†¡ê¸ˆ)
```

**RDS Security Group**:
```
Inbound:
  - 5432/tcp from ECS-SG       # ECSì—ì„œë§Œ

Outbound:
  - None
```

### 5.3 WAF ê·œì¹™ âš ï¸ (v1.1 Geo Blocking ì •ì±… ìƒì„¸í™”)

| ê·œì¹™ | ì„¤ëª… | ë™ì‘ |
|------|------|------|
| **Rate Limit** | IPë‹¹ 1000 req/5min | Block |
| **SQL Injection** | SQL ì¸ì ì…˜ íŒ¨í„´ | Block |
| **XSS** | XSS íŒ¨í„´ | Block |
| **Bad Bot** | ì•Œë ¤ì§„ ì•…ì„± ë´‡ | Block |
| **Geo Blocking** | í•œêµ­ ì™¸ IP | ê²½ë¡œë³„ ì°¨ë“± |

**Geo Blocking ìƒì„¸ ì •ì±…** âš ï¸ (v1.1 ì¶”ê°€):

| ê²½ë¡œ | í•œêµ­ ì™¸ IP | ë¹„ê³  |
|------|-----------|------|
| `/v1/admin/*` | **Block** | ê´€ë¦¬ì í˜ì´ì§€ |
| `/v1/auth/*` | **Block** | ì¸ì¦ API |
| `/v1/webhooks/*` | **Allow** (IP Whitelist) | PG/ì†¡ê¸ˆì‚¬ IPë§Œ í—ˆìš© |
| ê¸°íƒ€ API | **Count** | ëª¨ë‹ˆí„°ë§ í›„ ì •ì±… ê²°ì • |

**ì›¹í›… IP Whitelist**:
```
# PG (ì†Œí”„íŠ¸í˜ì´ë¨¼íŠ¸)
xxx.xxx.xxx.xxx/32

# ì†¡ê¸ˆì‚¬ (TBD)
xxx.xxx.xxx.xxx/32
```

---

## 6. PCI-DSS ì¤€ìˆ˜

### 6.1 SAQ-A ì ìš©

> PLICì€ ì¹´ë“œ ë°ì´í„°ë¥¼ ì§ì ‘ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ (PG ìœ„íƒ)

**ì±…ì„ ë¶„ë¦¬**:
| ì˜ì—­ | ì±…ì„ | ë¹„ê³  |
|------|------|------|
| ì¹´ë“œë²ˆí˜¸ ìˆ˜ì§‘ | PG (Softpayment SDK) | PLIC ì„œë²„ ë¯¸ê²½ìœ  |
| ì¹´ë“œ ì €ì¥ | PG | billingKeyë§Œ ìˆ˜ì‹  |
| ê²°ì œ ì²˜ë¦¬ | PG | API í˜¸ì¶œë§Œ |

### 6.2 ì¤€ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ì¹´ë“œ ë°ì´í„° ë¯¸ì €ì¥ (billingKeyë§Œ ì €ì¥)
- [x] ì¹´ë“œ ì…ë ¥ í™”ë©´ PG SDK ì‚¬ìš©
- [x] TLS 1.2 ì´ìƒ ì ìš©
- [x] ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì œì–´ (VPC, SG)
- [x] ë¡œê·¸ì— ì¹´ë“œ ì •ë³´ ë¯¸í¬í•¨
- [x] ì •ê¸° ì·¨ì•½ì  ìŠ¤ìº”

---

## 7. ê°œì¸ì •ë³´ ë³´í˜¸

### 7.1 ê°œì¸ì •ë³´ ì²˜ë¦¬ ì›ì¹™

| ì›ì¹™ | ì ìš© |
|------|------|
| **ìˆ˜ì§‘ ìµœì†Œí™”** | ì„œë¹„ìŠ¤ í•„ìˆ˜ ì •ë³´ë§Œ ìˆ˜ì§‘ |
| **ëª©ì  ì œí•œ** | ìˆ˜ì§‘ ëª©ì  ì™¸ ì‚¬ìš© ê¸ˆì§€ |
| **ì•”í˜¸í™”** | ë¯¼ê° ì •ë³´ ì•”í˜¸í™” ì €ì¥ |
| **ì ‘ê·¼ ì œì–´** | ë‹´ë‹¹ìë§Œ ì ‘ê·¼ ê°€ëŠ¥ |
| **ë³´ê´€ ê¸°í•œ** | ë²•ì • ë³´ê´€ í›„ íŒŒê¸° |

### 7.2 ê°œì¸ì •ë³´ ë³´ê´€ ê¸°ê°„

| ì •ë³´ | ë³´ê´€ ê¸°ê°„ | ê·¼ê±° |
|------|----------|------|
| ê±°ë˜ ê¸°ë¡ | 5ë…„ | ì „ìê¸ˆìœµê±°ë˜ë²• |
| ë³¸ì¸ì¸ì¦ ì •ë³´ | íƒˆí‡´ í›„ 90ì¼ | ì¬ê°€ì… ë°©ì§€ |
| ë§ˆì¼€íŒ… ë™ì˜ | ë™ì˜ ì² íšŒê¹Œì§€ | ê°œì¸ì •ë³´ë³´í˜¸ë²• |
| ì ‘ì† ë¡œê·¸ | 3ë…„ | í†µì‹ ë¹„ë°€ë³´í˜¸ë²• |

### 7.3 ê°œì¸ì •ë³´ ë§ˆìŠ¤í‚¹

| ë°ì´í„° | ë§ˆìŠ¤í‚¹ ì˜ˆì‹œ | ì ìš© ë²”ìœ„ |
|--------|-----------|----------|
| ì´ë¦„ | í™*ë™ | Admin ì¡°íšŒ |
| íœ´ëŒ€í° | 010-****-5678 | Admin ì¡°íšŒ |
| ê³„ì¢Œë²ˆí˜¸ | ********5678 | ëª¨ë“  í™”ë©´ |
| ì¹´ë“œë²ˆí˜¸ | 512345******1234 | ëª¨ë“  í™”ë©´ |

---

## 8. ë¡œê¹… ë° ê°ì‚¬

### 8.1 ê°ì‚¬ ë¡œê·¸ ëŒ€ìƒ

| ì´ë²¤íŠ¸ | ë¡œê·¸ ì—¬ë¶€ | ë³´ê´€ ê¸°ê°„ |
|--------|----------|----------|
| ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ | âœ… | 3ë…„ |
| ê±°ë˜ ìƒì„±/í™•ì •/ì·¨ì†Œ | âœ… | 5ë…„ |
| íšŒì› ì •ë³´ ë³€ê²½ | âœ… | 5ë…„ |
| Admin ì‘ì—… | âœ… | 5ë…„ |
| ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½ | âœ… | 5ë…„ |

### 8.2 ë¡œê·¸ í¬ë§·

```typescript
interface AuditLog {
  id: string;
  timestamp: string;
  userId: string;
  adminId?: string;
  action: string;
  targetType: string;
  targetId: string;
  beforeValue?: object;
  afterValue?: object;
  ipAddress: string;
  userAgent: string;
  result: 'SUCCESS' | 'FAILURE';
  reason?: string;
}
```

### 8.3 ë¯¼ê°ì •ë³´ ë¡œê¹… ê¸ˆì§€ âš ï¸ (v1.1 í•„ë“œ ëª…ì‹œ)

```typescript
// ë¡œê¹… ê¸ˆì§€ í•„ë“œ (CloudWatchì— í‰ë¬¸ ë…¸ì¶œ ê¸ˆì§€)
const NEVER_LOG = [
  'cardNumber',       // ì¹´ë“œë²ˆí˜¸
  'cvv',              // CVV/CVC
  'billingKey',       // PG ë¹Œë§í‚¤
  'accountNumber',    // ê³„ì¢Œë²ˆí˜¸ ì›ë¬¸
  'password',         // ë¹„ë°€ë²ˆí˜¸
  'ci',               // ì—°ê³„ì •ë³´
  'di',               // ì¤‘ë³µê°€ì…í™•ì¸ì •ë³´
  'accessToken',      // JWT ì•¡ì„¸ìŠ¤ í† í°
  'refreshToken',     // JWT ë¦¬í”„ë ˆì‹œ í† í°
  'phoneNumber',      // íœ´ëŒ€í°ë²ˆí˜¸ ì›ë¬¸
  'accountHolderName',// ì˜ˆê¸ˆì£¼ëª… ì›ë¬¸
];

// í‰ë¬¸ ë…¸ì¶œ ì‹œ ì¦‰ì‹œ ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤
// 1. CloudWatch Log Insightsì—ì„œ íƒì§€ ì¿¼ë¦¬ ì‹¤í–‰ (ì¼ 1íšŒ)
// 2. ë…¸ì¶œ ë°œê²¬ ì‹œ â†’ Security ì±„ë„ ì•Œë¦¼ â†’ ë¡œê·¸ ì‚­ì œ â†’ ì›ì¸ ë¶„ì„
```

### 8.4 admin_audit_logs í…Œì´ë¸” ë§¤í•‘ âš ï¸ (v1.1 ì¶”ê°€)

> âš ï¸ **SSOT ì°¸ì¡°**: PLIC_DB_SCHEMA.mdì˜ `admin_audit_logs` í…Œì´ë¸”

**í•„ë“œ ë§¤í•‘**:
| AuditLog í•„ë“œ | DB ì»¬ëŸ¼ | ë¹„ê³  |
|--------------|--------|------|
| `id` | `id` (UUID) | PK |
| `timestamp` | `created_at` | - |
| `adminId` | `admin_id` | FK â†’ admin_users |
| `action` | `action_type` | ENUM |
| `targetType` | `target_table` | í…Œì´ë¸”ëª… |
| `targetId` | `target_id` | ëŒ€ìƒ PK |
| `beforeValue` | `before_value` | JSONB |
| `afterValue` | `after_value` | JSONB |
| `ipAddress` | `ip_address` | - |
| `userAgent` | `user_agent` | - |

**ì ‘ê·¼ ê¶Œí•œ**:
| ì—­í•  | ì¡°íšŒ | ë‚´ë³´ë‚´ê¸° | ì‚­ì œ |
|------|------|---------|------|
| SUPER_ADMIN | âœ… | âœ… | âŒ (ë¶ˆê°€) |
| ADMIN | âœ… (ë³¸ì¸) | âŒ | âŒ |
| OPERATOR | âŒ | âŒ | âŒ |

**ë³´ê´€ ì •ì±…**:
- ë³´ê´€ ê¸°ê°„: 5ë…„ (ì „ìê¸ˆìœµê±°ë˜ë²•)
- ì‚­ì œ: ë¶ˆê°€ (Soft deleteë„ ë¶ˆê°€, ë²•ì  ë³´ê´€ ì˜ë¬´)
- ì•„ì¹´ì´ë¸Œ: 1ë…„ ì´ìƒ ê²½ê³¼ ì‹œ S3 Glacierë¡œ ì´ê´€

### 8.5 ì™¸ë¶€ ì›¹í›… ì„œëª… ê²€ì¦ âš ï¸ (v1.1 ì¶”ê°€)

> âš ï¸ **ì°¸ì¡°**: PLIC_EXTERNAL_INTERFACE.md ì„¹ì…˜ 2.6

**PG ì›¹í›… ì„œëª… ê²€ì¦** (í•„ìˆ˜):
```typescript
// HMAC-SHA256 ì„œëª… ê²€ì¦
function verifyWebhookSignature(
  payload: string,
  signature: string,
  timestamp: string
): boolean {
  const secretKey = process.env.PG_WEBHOOK_SECRET;
  const signatureData = `${timestamp}.${payload}`;
  
  const expectedSignature = crypto
    .createHmac('sha256', secretKey)
    .update(signatureData)
    .digest('hex');
  
  // íƒ€ì´ë° ê³µê²© ë°©ì§€
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}

// íƒ€ì„ìŠ¤íƒ¬í”„ ìœ íš¨ì„± (5ë¶„ ì´ë‚´)
function isTimestampValid(timestamp: string): boolean {
  const webhookTime = parseInt(timestamp, 10) * 1000;
  const now = Date.now();
  const TOLERANCE = 5 * 60 * 1000; // 5ë¶„
  
  return Math.abs(now - webhookTime) < TOLERANCE;
}
```

**ì„œëª… ê²€ì¦ ì‹¤íŒ¨ ì‹œ**:
1. 401 Unauthorized ì‘ë‹µ
2. Security ì•Œë¦¼ ë°œì†¡ (ì ì¬ì  ê³µê²©)
3. í•´ë‹¹ IP ë¡œê¹… ë° ë¶„ì„

---

## 9. ì·¨ì•½ì  ê´€ë¦¬

### 9.1 ì·¨ì•½ì  ìŠ¤ìº”

| ìœ í˜• | ë„êµ¬ | ì£¼ê¸° |
|------|------|------|
| ì˜ì¡´ì„± ì·¨ì•½ì  | Snyk | ë§¤ì¼ (CI/CD) |
| ì½”ë“œ ì·¨ì•½ì  | SonarQube | PRë§ˆë‹¤ |
| ì¸í”„ë¼ ì·¨ì•½ì  | AWS Inspector | ë§¤ì£¼ |
| ì›¹ ì·¨ì•½ì  | OWASP ZAP | ë§¤ì›” |

### 9.2 ì·¨ì•½ì  ëŒ€ì‘ SLA

| ì‹¬ê°ë„ | ëŒ€ì‘ ê¸°í•œ | ë¹„ê³  |
|--------|----------|------|
| Critical | 24ì‹œê°„ | ì¦‰ì‹œ íŒ¨ì¹˜ |
| High | 7ì¼ | ê¸´ê¸‰ íŒ¨ì¹˜ |
| Medium | 30ì¼ | ì •ê¸° íŒ¨ì¹˜ |
| Low | 90ì¼ | ë‹¤ìŒ ë¦´ë¦¬ì¦ˆ |

### 9.3 íŒ¨ì¹˜ ê´€ë¦¬

```
[íŒ¨ì¹˜ í”„ë¡œì„¸ìŠ¤]

1. ì·¨ì•½ì  íƒì§€ (ìë™/ìˆ˜ë™)
2. ì˜í–¥ë„ ë¶„ì„
3. íŒ¨ì¹˜ ê³„íš ìˆ˜ë¦½
4. Staging í…ŒìŠ¤íŠ¸
5. Production ë°°í¬
6. ê²€ì¦ ë° ë¬¸ì„œí™”
```

---

## 10. ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘

### 10.1 ì‚¬ê³  ë¶„ë¥˜

| ë“±ê¸‰ | ì •ì˜ | ì˜ˆì‹œ |
|------|------|------|
| **1ë“±ê¸‰** | ëŒ€ê·œëª¨ ë°ì´í„° ìœ ì¶œ | ê°œì¸ì •ë³´ 1ë§Œê±´ ì´ìƒ |
| **2ë“±ê¸‰** | ë¶€ë¶„ ë°ì´í„° ìœ ì¶œ | ê°œì¸ì •ë³´ 1ì²œê±´ ë¯¸ë§Œ |
| **3ë“±ê¸‰** | ì‹œìŠ¤í…œ ì¹¨ì… | ì„œë²„ ì ‘ê·¼ ê¶Œí•œ íƒˆì·¨ |
| **4ë“±ê¸‰** | ê³µê²© ì‹œë„ | ì°¨ë‹¨ëœ ê³µê²© |

### 10.2 ëŒ€ì‘ ì ˆì°¨

```
[1ë‹¨ê³„: íƒì§€/ì ‘ìˆ˜]
â”œâ”€â”€ ëª¨ë‹ˆí„°ë§ ì•Œë¦¼
â”œâ”€â”€ ë‚´ë¶€ ì œë³´
â””â”€â”€ ì™¸ë¶€ ì œë³´

[2ë‹¨ê³„: ì´ˆê¸° ëŒ€ì‘] (1ì‹œê°„ ë‚´)
â”œâ”€â”€ ë³´ì•ˆíŒ€ ì†Œì§‘
â”œâ”€â”€ ì¦ê±° ë³´ì „
â””â”€â”€ í”¼í•´ ë²”ìœ„ íŒŒì•…

[3ë‹¨ê³„: ê²©ë¦¬/ì°¨ë‹¨] (2ì‹œê°„ ë‚´)
â”œâ”€â”€ ì¹¨í•´ ì‹œìŠ¤í…œ ê²©ë¦¬
â”œâ”€â”€ ê³µê²© ê²½ë¡œ ì°¨ë‹¨
â””â”€â”€ ì¶”ê°€ í”¼í•´ ë°©ì§€

[4ë‹¨ê³„: ë¶„ì„/ë³µêµ¬] (24ì‹œê°„ ë‚´)
â”œâ”€â”€ ì›ì¸ ë¶„ì„
â”œâ”€â”€ ì‹œìŠ¤í…œ ë³µêµ¬
â””â”€â”€ ì¬ë°œ ë°©ì§€ ì¡°ì¹˜

[5ë‹¨ê³„: ì‚¬í›„ ì²˜ë¦¬] (72ì‹œê°„ ë‚´)
â”œâ”€â”€ ì‚¬ê³  ë³´ê³ ì„œ ì‘ì„±
â”œâ”€â”€ ê´€ê³„ ê¸°ê´€ ì‹ ê³  (í•„ìš”ì‹œ)
â””â”€â”€ ê³ ê° í†µì§€ (í•„ìš”ì‹œ)
```

### 10.3 ì‹ ê³  ì˜ë¬´

| ìƒí™© | ì‹ ê³  ê¸°ê´€ | ê¸°í•œ |
|------|----------|------|
| ê°œì¸ì •ë³´ ìœ ì¶œ (1ì²œëª… ì´ìƒ) | ê°œì¸ì •ë³´ë³´í˜¸ìœ„ì›íšŒ | 72ì‹œê°„ |
| ì „ìê¸ˆìœµ ì‚¬ê³  | ê¸ˆìœµê°ë…ì› | ì¦‰ì‹œ |
| ì¹¨í•´ ì‚¬ê³  | KISA | 24ì‹œê°„ |

---

## 11. ë³´ì•ˆ êµìœ¡

### 11.1 êµìœ¡ ëŒ€ìƒ

| ëŒ€ìƒ | êµìœ¡ ë‚´ìš© | ì£¼ê¸° |
|------|----------|------|
| ì „ ì§ì› | ë³´ì•ˆ ì¸ì‹ | ì—° 1íšŒ |
| ê°œë°œì | ì‹œíì–´ ì½”ë”© | ë¶„ê¸° 1íšŒ |
| ìš´ì˜ì | ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬ | ì—° 2íšŒ |
| ì‹ ê·œ ì…ì‚¬ì | ë³´ì•ˆ ì •ì±… | ì…ì‚¬ ì‹œ |

### 11.2 êµìœ¡ í•­ëª©

- ê°œì¸ì •ë³´ë³´í˜¸ë²• ì´í•´
- í”¼ì‹±/ì†Œì…œ ì—”ì§€ë‹ˆì–´ë§ ëŒ€ì‘
- ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬
- ë°ì´í„° ë¶„ë¥˜ ë° ì²˜ë¦¬
- ë³´ì•ˆ ì‚¬ê³  ì‹ ê³  ì ˆì°¨

---

## ë¶€ë¡

### A. ë³´ì•ˆ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ì¼ì¼ ì ê²€**:
- [ ] ë¡œê·¸ì¸ ì‹¤íŒ¨ ì´ìƒ íƒì§€
- [ ] ë¹„ì •ìƒ íŠ¸ë˜í”½ í™•ì¸
- [ ] ê¶Œí•œ ë³€ê²½ ë¡œê·¸ í™•ì¸

**ì£¼ê°„ ì ê²€**:
- [ ] ì·¨ì•½ì  ìŠ¤ìº” ê²°ê³¼ í™•ì¸
- [ ] ì ‘ê·¼ ê¶Œí•œ ê²€í† 
- [ ] ë°±ì—… ìƒíƒœ í™•ì¸

**ì›”ê°„ ì ê²€**:
- [ ] ë³´ì•ˆ íŒ¨ì¹˜ ì ìš© í˜„í™©
- [ ] ì¸ì¦ì„œ ë§Œë£Œì¼ í™•ì¸
- [ ] ì ‘ê·¼ ë¡œê·¸ ë¶„ì„

### B. Secrets Manager ì •ì±… âš ï¸ (v1.1 ì¶”ê°€)

**ê´€ë¦¬ ëŒ€ìƒ**:
| Secret | ìš©ë„ | ìˆœí™˜ ì£¼ê¸° |
|--------|------|----------|
| `plic/prod/pg-api-key` | PG API Key | 90ì¼ |
| `plic/prod/pg-secret` | PG Webhook Secret | 90ì¼ |
| `plic/prod/transfer-api-key` | ì†¡ê¸ˆ API Key | 90ì¼ |
| `plic/prod/jwt-secret` | JWT ì„œëª… í‚¤ | 180ì¼ |
| `plic/prod/db-password` | RDS ë¹„ë°€ë²ˆí˜¸ | 90ì¼ |

**ì ‘ê·¼ ê¶Œí•œ (ìµœì†Œ ê¶Œí•œ ì›ì¹™)**:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::xxx:role/plic-ecs-task-role"
      },
      "Action": [
        "secretsmanager:GetSecretValue"
      ],
      "Resource": "arn:aws:secretsmanager:ap-northeast-2:xxx:secret:plic/prod/*"
    }
  ]
}
```

### C. Runbook ì¸ë±ìŠ¤ âš ï¸ (v1.1 ì¶”ê°€)

> **ì°¸ì¡°**: PLIC_OPERATION_SOP.md

| ë³´ì•ˆ ì•ŒëŒ | Runbook | SOP ì„¹ì…˜ |
|----------|---------|---------|
| ë¡œê·¸ì¸ ì‹¤íŒ¨ 5íšŒ | ê³„ì • ì ê¸ˆ í™•ì¸ | SOP ì„¹ì…˜ 3 |
| ì›¹í›… ì„œëª… ê²€ì¦ ì‹¤íŒ¨ | ê³µê²© ë¶„ì„ | SOP ì„¹ì…˜ 5 |
| WAF Rate Limit ì´ˆê³¼ | IP ë¶„ì„/ì°¨ë‹¨ | SOP ì„¹ì…˜ 5 |
| DLQ ì ì²´ | ë©”ì‹œì§€ ë¶„ì„/ì¬ì²˜ë¦¬ | SOP ì„¹ì…˜ 2 |
| ëŒ€ì‚¬ ë¶ˆì¼ì¹˜ | ì›ì¸ íŒŒì•…/ìˆ˜ë™ ì²˜ë¦¬ | SOP ì„¹ì…˜ 4 |
| ì„œí‚·ë¸Œë ˆì´ì»¤ OPEN | ìê¸ˆ í™•ì¸/ë³µêµ¬ | SOP ì„¹ì…˜ 3 |

### D. ì°¸ê³  ë¬¸ì„œ

| ë¬¸ì„œ | ì—­í•  |
|------|------|
| PLIC_OPERATION_SOP.md | ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘ SOP |
| PLIC_OPERATIONS_HANDBOOK.md | ìš´ì˜ ê°€ì´ë“œ |
| PLIC_ENGINEERING_GUIDE.md | ê°œë°œ ë³´ì•ˆ ê°€ì´ë“œ |
| PLIC_DB_SCHEMA.md | ì•”í˜¸í™” í•„ë“œ ì •ì˜ |
| PLIC_EXTERNAL_INTERFACE.md | ì™¸ë¶€ ì—°ë™ ë³´ì•ˆ |
