# Plan: 프로젝트 구조 안정화

> **Feature**: PLIC 프로젝트의 구조적 안정화 및 유지보수성 개선
> **Created**: 2026-01-31
> **Author**: Claude + User
> **Status**: Planning

---

## 1. 배경 및 목적

### 1.1 현재 상황
- **프로젝트**: PLIC (모바일 송금 플랫폼)
- **기술 스택**: Next.js 16, React 19, TypeScript, Zustand, Tailwind CSS, AWS DynamoDB
- **규모**: 107개 파일 (TypeScript/React), 1.2MB 소스코드
- **품질 점수**: 62/100 (코드 분석 결과)

### 1.2 문제점
코드 분석 결과 다음과 같은 구조적 문제점이 발견됨:

#### 🚨 Critical (즉시 해결 필요)
1. **보안 취약점**
   - 관리자 비밀번호가 소스코드에 평문 노출
   - 결제 API에 인증 로직 누락
   - API URL이 하드코딩되어 환경별 관리 불가

2. **타입 안전성 부재**
   - TypeScript strict 모드 비활성화
   - 50개 이상의 `any` 타입 사용으로 타입 검증 무력화

#### ⚠️ High (단기 해결)
3. **아키텍처 문제**
   - 단일 파일 비대화 (api.ts 895줄, deals/new/page.tsx 1400줄)
   - Clean Architecture 위반 (Presentation에서 직접 DB 접근)
   - Store 간 순환 의존성 가능성

4. **UI/UX 일관성**
   - 모바일 프레임 레이아웃 규칙 위반 (`fixed` vs `absolute` 혼용)
   - z-index 레이어링 표준 불일치

#### 📊 Medium (중기 개선)
5. **코드 품질**
   - 중복 코드 (IUser 변환 로직, request 함수 등)
   - 빈 catch 블록으로 에러 무시
   - 매직 넘버/문자열 하드코딩

### 1.3 개선 목적
1. **보안 강화**: 배포 전 필수 보안 이슈 해결
2. **타입 안전성 확보**: TypeScript 본래 목적 달성
3. **유지보수성 향상**: 코드 가독성 및 확장성 개선
4. **아키텍처 정립**: Clean Architecture 원칙 적용
5. **개발 생산성 향상**: 일관된 패턴으로 신규 기능 개발 속도 향상

---

## 2. 목표 및 성공 기준

### 2.1 정량적 목표
| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| 코드 품질 점수 | 62/100 | 85+/100 | bkit:code-analyzer 재분석 |
| TypeScript strict 준수율 | 0% (비활성화) | 100% | `tsc --noEmit` 성공 |
| `any` 타입 사용 | 50+ | 5개 이하 | Grep 검색 결과 |
| 단일 파일 최대 줄 수 | 1400줄 | 300줄 이하 | wc -l |
| 보안 이슈 | 6개 (Critical) | 0개 | 보안 체크리스트 |

### 2.2 정성적 목표
- [ ] 새 개발자가 1일 내 프로젝트 구조 파악 가능
- [ ] 환경 변수로 모든 설정 외부화
- [ ] 컴포넌트 재사용성 50% 이상 향상
- [ ] API 응답 타입 자동완성 100% 지원
- [ ] 모바일 프레임 레이아웃 규칙 100% 준수

### 2.3 비목표 (Out of Scope)
- ❌ 새로운 기능 추가
- ❌ UI/UX 디자인 변경
- ❌ 백엔드 API 구조 변경
- ❌ 성능 최적화 (별도 프로젝트로 분리)
- ❌ 테스트 코드 작성 (Phase 2로 연기)

---

## 3. 범위 및 우선순위

### 3.1 Phase 1: Critical 보안 이슈 (즉시, 1일)
**우선순위**: P0 (배포 전 필수)

| 작업 | 영향도 | 난이도 | 예상 시간 |
|------|--------|--------|----------|
| 관리자 비밀번호 하드코딩 제거 | Critical | Low | 30분 |
| API URL 환경변수화 | Critical | Low | 30분 |
| 결제 API 인증 미들웨어 추가 | Critical | Medium | 2시간 |
| .env.example 파일 생성 | High | Low | 30분 |

**체크리스트**:
- [ ] `useAdminStore.ts`의 하드코딩된 비밀번호 제거
- [ ] 모든 하드코딩 URL을 `process.env.*`로 교체
- [ ] 결제 API 라우트에 JWT 검증 미들웨어 추가
- [ ] `.env.example` 파일 작성 및 README 업데이트

---

### 3.2 Phase 2: TypeScript Strict 모드 (1-2일)
**우선순위**: P0 (타입 안전성 기반)

| 작업 | 영향도 | 난이도 | 예상 시간 |
|------|--------|--------|----------|
| `tsconfig.json` strict: true 활성화 | High | Low | 10분 |
| API 응답 타입 정의 | High | High | 4시간 |
| `any` 타입 제거 (api.ts) | High | High | 3시간 |
| Store 타입 강화 | Medium | Medium | 2시간 |
| 컴파일 에러 수정 | High | High | 4시간 |

**체크리스트**:
- [ ] `src/types/api.ts` 파일 생성 (모든 API 응답 타입)
- [ ] `api.ts`의 `any`를 명시적 타입으로 교체
- [ ] useEffect 의존성 배열 수정
- [ ] 전체 프로젝트 `tsc --noEmit` 성공

---

### 3.3 Phase 3: 모바일 UI 레이아웃 수정 (반나절)
**우선순위**: P1 (UI 일관성)

| 작업 | 영향도 | 난이도 | 예상 시간 |
|------|--------|--------|----------|
| deals/new/page.tsx fixed → absolute | Medium | Low | 30분 |
| z-index 레이어링 표준화 | Medium | Low | 1시간 |
| 모바일 프레임 규칙 검증 스크립트 | Low | Medium | 1시간 |

**체크리스트**:
- [ ] 파일 미리보기 모달을 `absolute inset-0`로 수정
- [ ] z-index 상수 파일 생성 (`src/lib/zIndex.ts`)
- [ ] 모든 페이지 레이아웃 검증

---

### 3.4 Phase 4: 아키텍처 리팩토링 (2-3일)
**우선순위**: P1 (장기 유지보수)

| 작업 | 영향도 | 난이도 | 예상 시간 |
|------|--------|--------|----------|
| api.ts 도메인별 분리 | High | Medium | 3시간 |
| deals/new/page.tsx 컴포넌트 분리 | High | High | 4시간 |
| 중복 코드 유틸리티 추출 | Medium | Medium | 2시간 |
| Repository 패턴 도입 검토 | Medium | High | 4시간 |

**체크리스트**:
- [ ] `src/lib/api/` 폴더 생성
  - `authAPI.ts`, `dealsAPI.ts`, `usersAPI.ts`, `adminAPI.ts`, `paymentsAPI.ts`
- [ ] `src/components/deal/steps/` 폴더 생성
  - `TypeStep.tsx`, `AmountStep.tsx`, `RecipientStep.tsx`, `FilesStep.tsx`
- [ ] `src/lib/utils/` 폴더 생성
  - `userUtils.ts` (IUser 변환 로직)
  - `formatUtils.ts` (금액 포맷팅)
  - `requestUtils.ts` (공통 request 로직)

---

### 3.5 Phase 5: 유지보수성 개선 (1일)
**우선순위**: P2 (코드 품질)

| 작업 | 영향도 | 난이도 | 예상 시간 |
|------|--------|--------|----------|
| 상수 파일로 매직 넘버 이동 | Medium | Low | 2시간 |
| 에러 처리 로직 추가 | Medium | Medium | 2시간 |
| 환경 변수 검증 로직 | High | Low | 1시간 |
| ESLint 규칙 강화 | Low | Medium | 2시간 |

**체크리스트**:
- [ ] `src/lib/constants.ts` 생성
  - `MIN_AMOUNT`, `MAX_FILES`, `BANKS`, `GRADE_CONFIG` 등
- [ ] 빈 catch 블록에 에러 로깅 추가
- [ ] `src/lib/validateEnv.ts` 생성 (앱 시작 시 검증)
- [ ] ESLint 규칙: `no-console`, `no-debugger`, `no-any` 추가

---

## 4. 제약사항 및 리스크

### 4.1 제약사항
1. **기존 기능 유지**: 모든 리팩토링은 기능 동작에 영향 없어야 함
2. **점진적 마이그레이션**: 한 번에 전체 변경 금지 (롤백 불가)
3. **하위 호환성**: Store persist 데이터 마이그레이션 필요
4. **배포 일정**: Phase 1은 다음 배포 전 완료 필수

### 4.2 리스크 및 대응 방안

| 리스크 | 확률 | 영향도 | 대응 방안 |
|--------|------|--------|----------|
| TypeScript strict 활성화 시 대량 에러 발생 | High | High | 단계적 활성화 (`strictNullChecks`부터 시작) |
| 리팩토링 중 기능 오작동 | Medium | Critical | Phase별 수동 테스트 + Zero Script QA |
| 환경변수 누락으로 배포 실패 | Medium | High | 검증 스크립트 + 배포 전 체크리스트 |
| Store 마이그레이션 시 데이터 손실 | Low | Critical | 버전 관리 + fallback 로직 |
| 개발 일정 지연 | Medium | Medium | Phase 1/2 우선, 3/4/5는 선택적 진행 |

### 4.3 롤백 전략
- **Git 브랜치 전략**: 각 Phase별 별도 브랜치 (`refactor/phase-1-security` 등)
- **커밋 단위**: 작업 항목별 커밋 (원자적 변경)
- **태그**: Phase 완료 시 태그 생성 (`v0.1.0-refactor-phase1`)
- **롤백 조건**: 기능 오작동 발견 시 즉시 이전 Phase로 롤백

---

## 5. 이해관계자 및 의존성

### 5.1 이해관계자
| 역할 | 이름/팀 | 관심사 | 참여 수준 |
|------|---------|--------|----------|
| 개발자 | User | 코드 품질, 개발 생산성 | 의사결정 |
| AI Agent | Claude | 리팩토링 실행 | 실행자 |
| QA | (예정) | 기능 정상 동작 검증 | 검토자 |

### 5.2 의존성
- **선행 작업**: 없음 (독립 프로젝트)
- **후행 작업**:
  - 테스트 코드 작성 (별도 프로젝트)
  - 성능 최적화 (별도 프로젝트)
- **외부 의존성**:
  - AWS DynamoDB (기존 테이블 스키마 변경 없음)
  - Softpayment API (변경 없음)
  - Kakao API (변경 없음)

---

## 6. 일정 계획

### 6.1 전체 타임라인
```
[Phase 1] ████████ (1일)
[Phase 2] ████████████ (1-2일)
[Phase 3] ████ (0.5일)
[Phase 4] ████████████████ (2-3일)
[Phase 5] ████████ (1일)
─────────────────────────────────
Total: 5.5 - 7.5일 (실작업 시간)
```

### 6.2 마일스톤
| 마일스톤 | 완료 조건 | 목표 일자 |
|----------|----------|----------|
| M1: 보안 강화 완료 | Phase 1 체크리스트 100% | D+1 |
| M2: 타입 안전성 확보 | `tsc --noEmit` 성공 | D+3 |
| M3: UI 일관성 확보 | 모바일 프레임 규칙 100% | D+3.5 |
| M4: 아키텍처 정립 | 파일 분리 완료, 테스트 통과 | D+6.5 |
| M5: 코드 품질 85+ | 재분석 결과 목표 달성 | D+7.5 |

---

## 7. 리소스 요구사항

### 7.1 인력
- **개발**: 1명 (User + Claude)
- **검토**: 1명 (선택적)
- **QA**: (자동화된 Zero Script QA 활용)

### 7.2 도구 및 기술
- **필수**:
  - TypeScript 5.x
  - ESLint 9.x
  - bkit code-analyzer, gap-detector
- **선택**:
  - Prettier (코드 포맷팅)
  - Husky (pre-commit 훅)

### 7.3 인프라
- 변경 없음 (기존 환경 사용)

---

## 8. 커뮤니케이션 계획

### 8.1 진행 상황 보고
- **주기**: 각 Phase 완료 시
- **방법**: PDCA Report 문서 생성
- **내용**: 완료 항목, 발견된 이슈, 다음 단계

### 8.2 문서화
- **Plan 문서** (현재 문서): 전체 계획
- **Design 문서** (다음 단계): 상세 설계 및 구현 방법
- **Analysis 문서**: 설계 vs 구현 Gap 분석
- **Report 문서**: 최종 완료 보고서

---

## 9. 다음 단계

### 9.1 즉시 수행
1. ✅ Plan 문서 검토 및 승인
2. ⏳ Design 문서 작성 (`/pdca design 프로젝트-구조-안정화`)
3. ⏳ Phase 1 작업 시작

### 9.2 승인 필요 사항
- [ ] Phase 1~5 우선순위 확인
- [ ] Phase 4/5 선택적 진행 여부 결정
- [ ] 타임라인 조정 필요 여부

---

## 10. 부록

### 10.1 참고 문서
- [CLAUDE.md](/Users/sungminbang/Plic/CLAUDE.md) - 프로젝트 개발 규칙
- [코드 분석 리포트](#) - bkit:code-analyzer 결과 (Agent ID: a4540b0)

### 10.2 용어 정리
- **모바일 프레임**: 375px × 812px 시뮬레이션 영역 (Fitpetmall 스타일)
- **Clean Architecture**: Presentation-Domain-Infrastructure 레이어 분리
- **Store persist**: Zustand 상태를 localStorage에 저장하는 미들웨어
- **Zero Script QA**: 테스트 스크립트 없이 Docker 로그로 검증하는 방법론

---

**Plan 문서 작성 완료**: 2026-01-31
**다음 단계**: Design 문서 작성 (`/pdca design 프로젝트-구조-안정화`)
