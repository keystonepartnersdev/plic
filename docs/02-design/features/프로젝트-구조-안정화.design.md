# Design: í”„ë¡œì íŠ¸ êµ¬ì¡° ì•ˆì •í™”

> **Feature**: PLIC í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ì  ì•ˆì •í™” ë° ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ 
> **Created**: 2026-01-31
> **Author**: Claude + User
> **Status**: Design
> **Based on**: [Plan ë¬¸ì„œ](../../01-plan/features/í”„ë¡œì íŠ¸-êµ¬ì¡°-ì•ˆì •í™”.plan.md)

---

## ëª©ì°¨
1. [Phase 1: Critical ë³´ì•ˆ ì´ìŠˆ](#phase-1-critical-ë³´ì•ˆ-ì´ìŠˆ)
2. [Phase 2: TypeScript Strict ëª¨ë“œ](#phase-2-typescript-strict-ëª¨ë“œ)
3. [Phase 3: ëª¨ë°”ì¼ UI ë ˆì´ì•„ì›ƒ](#phase-3-ëª¨ë°”ì¼-ui-ë ˆì´ì•„ì›ƒ)
4. [Phase 4: ì•„í‚¤í…ì²˜ ë¦¬íŒ©í† ë§](#phase-4-ì•„í‚¤í…ì²˜-ë¦¬íŒ©í† ë§)
5. [Phase 5: ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ ](#phase-5-ìœ ì§€ë³´ìˆ˜ì„±-ê°œì„ )
6. [êµ¬í˜„ ìˆœì„œ](#êµ¬í˜„-ìˆœì„œ)
7. [ê²€ì¦ ë°©ë²•](#ê²€ì¦-ë°©ë²•)

---

## Phase 1: Critical ë³´ì•ˆ ì´ìŠˆ

### 1.1 í™˜ê²½ ë³€ìˆ˜ êµ¬ì¡° ì„¤ê³„

#### íŒŒì¼: `.env.example`
```bash
# ============================================
# Server-side Environment Variables
# ============================================

# AWS Configuration
AWS_REGION=ap-northeast-2
AWS_ACCESS_KEY_ID=your_access_key_id
AWS_SECRET_ACCESS_KEY=your_secret_access_key
DEALS_TABLE=plic-deals-prod

# API Base URL (Backend)
API_BASE_URL=https://your-api.execute-api.ap-northeast-2.amazonaws.com/Prod

# Kakao API
KAKAO_REST_API_KEY=your_kakao_rest_api_key
KAKAO_CLIENT_SECRET=your_kakao_client_secret
KAKAO_ADMIN_KEY=your_kakao_admin_key

# Popbill API (ê³„ì¢Œ ì¸ì¦)
POPBILL_LINK_ID=your_popbill_link_id
POPBILL_SECRET_KEY=your_popbill_secret_key
POPBILL_CORP_NUM=your_corp_num

# Softpayment API (ê²°ì œ)
SOFTPAYMENT_API_URL=https://api.softpayment.co.kr
SOFTPAYMENT_PAY_KEY=your_softpayment_pay_key

# Admin Authentication (ì„œë²„ ì „ìš©)
ADMIN_SECRET_KEY=your_secure_admin_secret_key_min_32_chars

# ============================================
# Client-side Environment Variables
# (NEXT_PUBLIC_* ì ‘ë‘ì‚¬ í•„ìˆ˜)
# ============================================

NEXT_PUBLIC_BASE_URL=https://plic.app
NEXT_PUBLIC_AWS_REGION=ap-northeast-2
NEXT_PUBLIC_S3_BUCKET_NAME=plic-uploads
NEXT_PUBLIC_S3_URL=https://plic-uploads.s3.ap-northeast-2.amazonaws.com
```

#### íŒŒì¼: `src/lib/validateEnv.ts` (ì‹ ê·œ ìƒì„±)
```typescript
/**
 * í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ë° íƒ€ì… ì•ˆì „í•œ ì ‘ê·¼
 */

interface ServerEnv {
  AWS_REGION: string;
  AWS_ACCESS_KEY_ID: string;
  AWS_SECRET_ACCESS_KEY: string;
  DEALS_TABLE: string;
  API_BASE_URL: string;
  KAKAO_REST_API_KEY: string;
  KAKAO_CLIENT_SECRET: string;
  KAKAO_ADMIN_KEY: string;
  POPBILL_LINK_ID: string;
  POPBILL_SECRET_KEY: string;
  POPBILL_CORP_NUM: string;
  SOFTPAYMENT_API_URL: string;
  SOFTPAYMENT_PAY_KEY: string;
  ADMIN_SECRET_KEY: string;
}

interface ClientEnv {
  NEXT_PUBLIC_BASE_URL: string;
  NEXT_PUBLIC_AWS_REGION: string;
  NEXT_PUBLIC_S3_BUCKET_NAME: string;
  NEXT_PUBLIC_S3_URL: string;
}

/**
 * ì„œë²„ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ (ì„œë²„ ì»´í¬ë„ŒíŠ¸/API ë¼ìš°íŠ¸ ì „ìš©)
 */
export function validateServerEnv(): ServerEnv {
  const required: (keyof ServerEnv)[] = [
    'AWS_REGION',
    'AWS_ACCESS_KEY_ID',
    'AWS_SECRET_ACCESS_KEY',
    'DEALS_TABLE',
    'API_BASE_URL',
    'ADMIN_SECRET_KEY',
  ];

  const missing = required.filter((key) => !process.env[key]);

  if (missing.length > 0) {
    throw new Error(
      `Missing required server environment variables: ${missing.join(', ')}`
    );
  }

  return process.env as unknown as ServerEnv;
}

/**
 * í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
 */
export function validateClientEnv(): ClientEnv {
  const required: (keyof ClientEnv)[] = [
    'NEXT_PUBLIC_BASE_URL',
    'NEXT_PUBLIC_AWS_REGION',
    'NEXT_PUBLIC_S3_BUCKET_NAME',
    'NEXT_PUBLIC_S3_URL',
  ];

  const missing = required.filter((key) => !process.env[key]);

  if (missing.length > 0) {
    throw new Error(
      `Missing required client environment variables: ${missing.join(', ')}`
    );
  }

  return {
    NEXT_PUBLIC_BASE_URL: process.env.NEXT_PUBLIC_BASE_URL!,
    NEXT_PUBLIC_AWS_REGION: process.env.NEXT_PUBLIC_AWS_REGION!,
    NEXT_PUBLIC_S3_BUCKET_NAME: process.env.NEXT_PUBLIC_S3_BUCKET_NAME!,
    NEXT_PUBLIC_S3_URL: process.env.NEXT_PUBLIC_S3_URL!,
  };
}

// íƒ€ì… ì•ˆì „í•œ í™˜ê²½ ë³€ìˆ˜ ì ‘ê·¼
export const serverEnv = validateServerEnv();
export const clientEnv = validateClientEnv();
```

---

### 1.2 ê´€ë¦¬ì ì¸ì¦ ê°œì„ 

#### ë³€ê²½ íŒŒì¼: `src/stores/useAdminStore.ts`

**í˜„ì¬ ë¬¸ì œ**:
```typescript
// âŒ í•˜ë“œì½”ë”©ëœ ë¹„ë°€ë²ˆí˜¸
admins: [
  { id: '1', username: 'admin', password: 'admin1234', ... },
  { id: '2', username: 'manager', password: 'admin123', ... },
],
```

**ê°œì„  ì„¤ê³„**:
```typescript
import { serverEnv } from '@/lib/validateEnv';

interface IAdminStore {
  // ... ê¸°ì¡´ ì¸í„°í˜ì´ìŠ¤
  validateAdminCredentials: (username: string, password: string) => Promise<boolean>;
}

export const useAdminStore = create<IAdminStore>()(
  persist(
    (set, get) => ({
      admins: [
        {
          id: '1',
          username: 'admin',
          // âŒ password í•„ë“œ ì œê±°
          name: 'ê´€ë¦¬ì',
          role: 'super',
          email: 'admin@plic.app',
          createdAt: '2024-01-01T00:00:00Z',
        },
      ],

      // âœ… ì„œë²„ ì¸¡ ì¸ì¦ìœ¼ë¡œ ë³€ê²½
      validateAdminCredentials: async (username: string, password: string) => {
        try {
          // ì„œë²„ API í˜¸ì¶œë¡œ ì¸ì¦ ì²˜ë¦¬
          const response = await fetch('/api/admin/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });

          if (!response.ok) return false;

          const { token, admin } = await response.json();

          // í† í° ì €ì¥ ë° ê´€ë¦¬ì ì •ë³´ ì—…ë°ì´íŠ¸
          localStorage.setItem('adminToken', token);
          set({ currentAdmin: admin });

          return true;
        } catch (error) {
          console.error('Admin authentication failed:', error);
          return false;
        }
      },

      login: async (username: string, password: string) => {
        const isValid = await get().validateAdminCredentials(username, password);

        if (!isValid) {
          alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }

        // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬ëŠ” validateAdminCredentialsì—ì„œ ì™„ë£Œë¨
      },
    }),
    // ... persist ì„¤ì •
  )
);
```

#### ì‹ ê·œ íŒŒì¼: `src/app/api/admin/auth/login/route.ts`
```typescript
import { NextRequest, NextResponse } from 'next/server';
import { serverEnv } from '@/lib/validateEnv';
import crypto from 'crypto';

/**
 * ê´€ë¦¬ì ë¡œê·¸ì¸ API
 *
 * ë³´ì•ˆ ì„¤ê³„:
 * 1. ë¹„ë°€ë²ˆí˜¸ëŠ” í™˜ê²½ ë³€ìˆ˜ì—ì„œ í•´ì‹œê°’ìœ¼ë¡œ ì €ì¥
 * 2. JWT í† í° ë°œê¸‰ (ìœ íš¨ê¸°ê°„ 8ì‹œê°„)
 * 3. Rate Limiting (IPë‹¹ ë¶„ë‹¹ 5íšŒ)
 */

// í™˜ê²½ ë³€ìˆ˜ì—ì„œ í•´ì‹œëœ ê´€ë¦¬ì ì •ë³´ ë¡œë“œ
const ADMIN_USERS = [
  {
    username: 'admin',
    passwordHash: hashPassword('admin1234'), // ì‹¤ì œë¡œëŠ” í™˜ê²½ë³€ìˆ˜ì—ì„œ
    role: 'super',
    name: 'ê´€ë¦¬ì',
  },
];

function hashPassword(password: string): string {
  return crypto
    .createHmac('sha256', serverEnv.ADMIN_SECRET_KEY)
    .update(password)
    .digest('hex');
}

function generateToken(username: string, role: string): string {
  // JWT í† í° ìƒì„± ë¡œì§ (ì‹¤ì œë¡œëŠ” jsonwebtoken ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)
  const payload = { username, role, exp: Date.now() + 8 * 60 * 60 * 1000 };
  return Buffer.from(JSON.stringify(payload)).toString('base64');
}

export async function POST(request: NextRequest) {
  try {
    const { username, password } = await request.json();

    if (!username || !password) {
      return NextResponse.json(
        { error: 'Username and password are required' },
        { status: 400 }
      );
    }

    const admin = ADMIN_USERS.find((u) => u.username === username);

    if (!admin || hashPassword(password) !== admin.passwordHash) {
      return NextResponse.json(
        { error: 'Invalid credentials' },
        { status: 401 }
      );
    }

    const token = generateToken(admin.username, admin.role);

    return NextResponse.json({
      token,
      admin: {
        username: admin.username,
        name: admin.name,
        role: admin.role,
      },
    });
  } catch (error) {
    console.error('Admin login error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

---

### 1.3 API URL í™˜ê²½ë³€ìˆ˜í™”

#### ë³€ê²½ íŒŒì¼: `src/lib/api.ts`

**ë³€ê²½ ì „**:
```typescript
// âŒ í•˜ë“œì½”ë”©
const API_BASE_URL = 'https://szxmlb6qla.execute-api.ap-northeast-2.amazonaws.com/Prod';
```

**ë³€ê²½ í›„**:
```typescript
// âœ… í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©
import { serverEnv } from './validateEnv';

const API_BASE_URL = serverEnv.API_BASE_URL;

// í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì‚¬ìš© ì‹œ (ë¸Œë¼ìš°ì €)
const getApiBaseUrl = () => {
  if (typeof window === 'undefined') {
    // ì„œë²„ ì¸¡
    return serverEnv.API_BASE_URL;
  } else {
    // í´ë¼ì´ì–¸íŠ¸ ì¸¡ - ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© (í”„ë¡ì‹œë¥¼ í†µí•´)
    return '/api/proxy';
  }
};
```

#### ì‹ ê·œ íŒŒì¼: `next.config.js` (í”„ë¡ì‹œ ì„¤ì •)
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  async rewrites() {
    return [
      {
        source: '/api/proxy/:path*',
        destination: `${process.env.API_BASE_URL}/:path*`,
      },
    ];
  },
};

module.exports = nextConfig;
```

---

### 1.4 ê²°ì œ API ì¸ì¦ ë¯¸ë“¤ì›¨ì–´

#### ì‹ ê·œ íŒŒì¼: `src/lib/auth/middleware.ts`
```typescript
import { NextRequest, NextResponse } from 'next/server';

/**
 * JWT í† í° ê²€ì¦ ë¯¸ë“¤ì›¨ì–´
 */
export async function requireAuth(
  request: NextRequest,
  handler: (req: NextRequest, userId: string) => Promise<NextResponse>
): Promise<NextResponse> {
  const authHeader = request.headers.get('Authorization');

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return NextResponse.json(
      { error: 'Unauthorized: Missing token' },
      { status: 401 }
    );
  }

  const token = authHeader.substring(7);

  try {
    // JWT í† í° ê²€ì¦ (ì‹¤ì œë¡œëŠ” jsonwebtoken ì‚¬ìš©)
    const userId = await verifyToken(token);

    if (!userId) {
      return NextResponse.json(
        { error: 'Unauthorized: Invalid token' },
        { status: 401 }
      );
    }

    // ì¸ì¦ ì„±ê³µ - ì›ë˜ í•¸ë“¤ëŸ¬ ì‹¤í–‰
    return await handler(request, userId);
  } catch (error) {
    console.error('Token verification failed:', error);
    return NextResponse.json(
      { error: 'Unauthorized: Token verification failed' },
      { status: 401 }
    );
  }
}

async function verifyToken(token: string): Promise<string | null> {
  // JWT ê²€ì¦ ë¡œì§
  // ì‹¤ì œë¡œëŠ” aws-jwt-verify ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
  try {
    const payload = JSON.parse(Buffer.from(token, 'base64').toString());

    if (payload.exp < Date.now()) {
      return null; // í† í° ë§Œë£Œ
    }

    return payload.userId;
  } catch {
    return null;
  }
}
```

#### ë³€ê²½ íŒŒì¼: `src/app/api/payments/billing-key/pay/route.ts`

**ë³€ê²½ ì „**:
```typescript
export async function POST(request: NextRequest) {
  // âŒ ì¸ì¦ ì—†ìŒ
  const body = await request.json();
  // ... ê²°ì œ ì²˜ë¦¬
}
```

**ë³€ê²½ í›„**:
```typescript
import { requireAuth } from '@/lib/auth/middleware';

export async function POST(request: NextRequest) {
  return requireAuth(request, async (req, userId) => {
    const body = await req.json();

    // âœ… userIdë¡œ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
    const user = await getUserById(userId);

    if (!user || user.status !== 'active') {
      return NextResponse.json(
        { error: 'User not eligible for payment' },
        { status: 403 }
      );
    }

    // ... ê²°ì œ ì²˜ë¦¬
  });
}
```

---

## Phase 2: TypeScript Strict ëª¨ë“œ

### 2.1 API ì‘ë‹µ íƒ€ì… ì •ì˜

#### ì‹ ê·œ íŒŒì¼: `src/types/api.ts`
```typescript
/**
 * API ì‘ë‹µ íƒ€ì… ì •ì˜
 *
 * ëª¨ë“  API í˜¸ì¶œì€ ì´ íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ì… ì•ˆì „ì„± í™•ë³´
 */

import { IUser } from './user';
import { IDeal } from './deal';
import { IPayment } from './payment';
import { IContent } from './content';

// ===== ê³µí†µ ì‘ë‹µ êµ¬ì¡° =====

export interface ApiResponse<T> {
  data: T;
  message?: string;
  timestamp: string;
}

export interface ApiError {
  error: string;
  code?: string;
  details?: Record<string, unknown>;
}

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  hasMore: boolean;
}

// ===== ì¸ì¦ API =====

export interface LoginRequest {
  phone: string;
  verificationCode?: string;
}

export interface LoginResponse {
  token: string;
  user: IUser;
  isNewUser: boolean;
}

export interface SignupRequest {
  phone: string;
  name: string;
  email?: string;
  agreeTerms: boolean;
  agreePrivacy: boolean;
  agreeMarketing?: boolean;
}

export interface SignupResponse {
  token: string;
  user: IUser;
}

// ===== ì‚¬ìš©ì API =====

export interface GetUserResponse extends IUser {}

export interface UpdateUserRequest {
  name?: string;
  email?: string;
  bankCode?: string;
  accountNumber?: string;
}

export interface UpdateUserResponse extends IUser {}

// ===== ê±°ë˜ API =====

export interface CreateDealRequest {
  type: 'personal' | 'business';
  amount: number;
  recipientName: string;
  recipientPhone: string;
  recipientBankCode: string;
  recipientAccount: string;
  businessNumber?: string;
  files?: string[]; // S3 URLs
}

export interface CreateDealResponse extends IDeal {}

export interface ListDealsRequest {
  status?: IDeal['status'];
  page?: number;
  limit?: number;
}

export interface ListDealsResponse extends PaginatedResponse<IDeal> {}

export interface GetDealResponse extends IDeal {}

// ===== ê²°ì œ API =====

export interface CreatePaymentRequest {
  dealId: string;
  method: 'card' | 'billing';
  billingKeyId?: string;
}

export interface CreatePaymentResponse extends IPayment {}

export interface PaymentCallbackData {
  trxId: string;
  status: 'success' | 'failed';
  message?: string;
}

// ===== ì»¨í…ì¸  API =====

export interface ListBannersResponse {
  banners: IContent[];
}

export interface ListNoticesResponse extends PaginatedResponse<IContent> {}

export interface ListFaqsResponse {
  faqs: IContent[];
}

// ===== ê´€ë¦¬ì API =====

export interface AdminLoginRequest {
  username: string;
  password: string;
}

export interface AdminLoginResponse {
  token: string;
  admin: {
    username: string;
    name: string;
    role: 'super' | 'manager' | 'viewer';
  };
}

export interface AdminListUsersRequest {
  search?: string;
  status?: IUser['status'];
  page?: number;
  limit?: number;
}

export interface AdminListUsersResponse extends PaginatedResponse<IUser> {}

export interface AdminUpdateUserRequest {
  status?: IUser['status'];
  grade?: IUser['grade'];
}
```

---

### 2.2 api.ts íƒ€ì… ê°•í™”

#### ë³€ê²½ íŒŒì¼: `src/lib/api.ts`

**ë³€ê²½ ì „**:
```typescript
// âŒ any íƒ€ì… ë‚¨ìš©
const request = async <T = any>(
  endpoint: string,
  options?: RequestInit
): Promise<T> => {
  const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
  return response.json();
};

// âŒ any ë°˜í™˜
export const api = {
  getMe: () => request<any>('/users/me'),
  getDeals: () => request<any[]>('/deals'),
};
```

**ë³€ê²½ í›„**:
```typescript
import type {
  ApiResponse,
  ApiError,
  LoginRequest,
  LoginResponse,
  GetUserResponse,
  ListDealsResponse,
  CreateDealRequest,
  CreateDealResponse,
  // ... ëª¨ë“  íƒ€ì… import
} from '@/types/api';

// âœ… ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± í™•ë³´
const request = async <T>(
  endpoint: string,
  options?: RequestInit
): Promise<T> => {
  try {
    const response = await fetch(`${getApiBaseUrl()}${endpoint}`, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...options?.headers,
      },
    });

    if (!response.ok) {
      const error: ApiError = await response.json();
      throw new Error(error.error || 'API request failed');
    }

    return await response.json();
  } catch (error) {
    console.error(`API Error [${endpoint}]:`, error);
    throw error;
  }
};

// âœ… ëª…ì‹œì  íƒ€ì…ìœ¼ë¡œ API ì •ì˜
export const api = {
  // ì¸ì¦
  login: (data: LoginRequest) =>
    request<LoginResponse>('/auth/login', {
      method: 'POST',
      body: JSON.stringify(data),
    }),

  // ì‚¬ìš©ì
  getMe: () =>
    request<GetUserResponse>('/users/me', {
      headers: { Authorization: `Bearer ${getToken()}` },
    }),

  updateUser: (data: UpdateUserRequest) =>
    request<UpdateUserResponse>('/users/me', {
      method: 'PATCH',
      headers: { Authorization: `Bearer ${getToken()}` },
      body: JSON.stringify(data),
    }),

  // ê±°ë˜
  listDeals: (params?: ListDealsRequest) =>
    request<ListDealsResponse>(`/deals?${new URLSearchParams(params as any)}`, {
      headers: { Authorization: `Bearer ${getToken()}` },
    }),

  createDeal: (data: CreateDealRequest) =>
    request<CreateDealResponse>('/deals', {
      method: 'POST',
      headers: { Authorization: `Bearer ${getToken()}` },
      body: JSON.stringify(data),
    }),

  // ... ë‚˜ë¨¸ì§€ APIë“¤ë„ ë™ì¼í•˜ê²Œ íƒ€ì… ì§€ì •
};
```

---

### 2.3 tsconfig.json strict ëª¨ë“œ í™œì„±í™”

#### ë³€ê²½ íŒŒì¼: `tsconfig.json`

**ë‹¨ê³„ì  í™œì„±í™” ì „ëµ**:
```json
{
  "compilerOptions": {
    // ===== Step 1: ê¸°ë³¸ strict ì˜µì…˜ =====
    "strict": true,

    // ===== Step 2: ê°œë³„ ì˜µì…˜ ë¯¸ì„¸ ì¡°ì • (í•„ìš” ì‹œ) =====
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,

    // ===== Step 3: ì¶”ê°€ ì•ˆì „ì„± ì˜µì…˜ =====
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,

    // ê¸°ì¡´ ì„¤ì • ìœ ì§€
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "incremental": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "plugins": [{ "name": "next" }],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

---

### 2.4 Store íƒ€ì… ê°•í™”

#### ë³€ê²½ íŒŒì¼: `src/stores/useUserStore.ts`

**ë³€ê²½ ì „**:
```typescript
// âŒ any íƒ€ì…
migrate: (persistedState: any, version: number) => { ... }
```

**ë³€ê²½ í›„**:
```typescript
interface PersistedUserState {
  currentUser: IUser | null;
  users: IUser[];
  _hasHydrated: boolean;
}

export const useUserStore = create<IUserStore>()(
  persist(
    (set, get) => ({
      // ... ìƒíƒœ ë° ì•¡ì…˜
    }),
    {
      name: 'user-storage',
      version: 1,
      // âœ… ëª…ì‹œì  íƒ€ì…
      migrate: (persistedState: unknown, version: number): PersistedUserState => {
        // íƒ€ì… ê°€ë“œë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
        if (
          typeof persistedState === 'object' &&
          persistedState !== null &&
          'currentUser' in persistedState
        ) {
          return persistedState as PersistedUserState;
        }

        // ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§
        return {
          currentUser: null,
          users: [],
          _hasHydrated: false,
        };
      },
    }
  )
);
```

---

## Phase 3: ëª¨ë°”ì¼ UI ë ˆì´ì•„ì›ƒ

### 3.1 z-index ë ˆì´ì–´ë§ í‘œì¤€í™”

#### ì‹ ê·œ íŒŒì¼: `src/lib/zIndex.ts`
```typescript
/**
 * z-index ë ˆì´ì–´ë§ í‘œì¤€
 *
 * CLAUDE.md ê·œì¹™:
 * - z-0: ë°°ê²½ ì½˜í…ì¸  (ê¸°ë³¸)
 * - z-10: ìŠ¤í‹°í‚¤ í—¤ë”/íƒ­
 * - z-20: í”Œë¡œíŒ… ë²„íŠ¼
 * - z-40: ëª¨ë‹¬ ì˜¤ë²„ë ˆì´
 * - z-50: ëª¨ë‹¬ ì»¨í…ì¸ 
 */

export const Z_INDEX = {
  // ë°°ê²½ ë° ê¸°ë³¸ ì½˜í…ì¸ 
  BASE: 0,

  // ê³ ì • ìš”ì†Œ
  STICKY_HEADER: 10,
  STICKY_TAB: 10,

  // í”Œë¡œíŒ… ìš”ì†Œ
  FLOATING_BUTTON: 20,
  FLOATING_ACTION: 20,

  // ì˜¤ë²„ë ˆì´
  MODAL_OVERLAY: 40,
  DRAWER_OVERLAY: 40,

  // ìµœìƒìœ„ UI
  MODAL_CONTENT: 50,
  DRAWER_CONTENT: 50,
  BOTTOM_NAV: 50,
  TOAST: 60,
} as const;

// Tailwind í´ë˜ìŠ¤ ìœ í‹¸ë¦¬í‹°
export const zIndexClasses = {
  base: 'z-0',
  stickyHeader: 'z-10',
  stickyTab: 'z-10',
  floatingButton: 'z-20',
  modalOverlay: 'z-40',
  modalContent: 'z-50',
  bottomNav: 'z-50',
  toast: 'z-[60]',
} as const;
```

---

### 3.2 ëª¨ë°”ì¼ í”„ë ˆì„ ë ˆì´ì•„ì›ƒ ìˆ˜ì •

#### ë³€ê²½ íŒŒì¼: `src/app/(customer)/deals/new/page.tsx`

**ë¼ì¸ 1192 ìˆ˜ì •**:
```tsx
// âŒ ë³€ê²½ ì „: viewport ê¸°ì¤€ ë°°ì¹˜
{showFilePreview && selectedFile && (
  <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90">
    {/* ... */}
  </div>
)}

// âœ… ë³€ê²½ í›„: ëª¨ë°”ì¼ í”„ë ˆì„ ê¸°ì¤€ ë°°ì¹˜
{showFilePreview && selectedFile && (
  <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/90">
    {/* ... */}
  </div>
)}
```

**z-index í‘œì¤€í™”**:
```tsx
import { zIndexClasses } from '@/lib/zIndex';

// ë¼ì¸ 1156: ì‚­ì œ ë²„íŠ¼
<button className={`... ${zIndexClasses.floatingButton}`}>

// ë¼ì¸ 1163: ë¯¸ë¦¬ë³´ê¸° ì•„ì´ì½˜
<button className={`... ${zIndexClasses.floatingButton}`}>

// ë¼ì¸ 1192: íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬
<div className={`absolute inset-0 ${zIndexClasses.modalContent} ...`}>
```

---

### 3.3 ë ˆì´ì•„ì›ƒ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

#### ì‹ ê·œ íŒŒì¼: `scripts/validate-layout.ts`
```typescript
/**
 * ëª¨ë°”ì¼ í”„ë ˆì„ ë ˆì´ì•„ì›ƒ ê·œì¹™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 *
 * ì‹¤í–‰: npm run validate:layout
 */

import fs from 'fs';
import path from 'path';
import { glob } from 'glob';

const CUSTOMER_PAGES_DIR = 'src/app/(customer)';

interface ValidationResult {
  file: string;
  line: number;
  issue: string;
  severity: 'error' | 'warning';
}

async function validateLayout(): Promise<ValidationResult[]> {
  const results: ValidationResult[] = [];

  // (customer) í´ë”ì˜ ëª¨ë“  TSX íŒŒì¼ ê²€ìƒ‰
  const files = await glob(`${CUSTOMER_PAGES_DIR}/**/*.tsx`);

  for (const file of files) {
    const content = fs.readFileSync(file, 'utf-8');
    const lines = content.split('\n');

    lines.forEach((line, index) => {
      const lineNum = index + 1;

      // ê·œì¹™ 1: fixed í¬ì§€ì…˜ ê¸ˆì§€ (ê³ ê°ìš© UI)
      if (/className=["'][^"']*\bfixed\b/.test(line)) {
        results.push({
          file,
          line: lineNum,
          issue: 'ê³ ê°ìš© UIì—ì„œ fixed í¬ì§€ì…˜ ì‚¬ìš© ê¸ˆì§€. absolute ì‚¬ìš© ê¶Œì¥.',
          severity: 'error',
        });
      }

      // ê·œì¹™ 2: viewport ê¸°ì¤€ ì¤‘ì•™ ë°°ì¹˜ ê¸ˆì§€
      if (/className=["'][^"']*\b(top-1\/2|left-1\/2|-translate-x-1\/2|-translate-y-1\/2)\b/.test(line)) {
        results.push({
          file,
          line: lineNum,
          issue: 'viewport ê¸°ì¤€ ì¤‘ì•™ ë°°ì¹˜ ê°ì§€. ëª¨ë°”ì¼ í”„ë ˆì„ ê¸°ì¤€ ë°°ì¹˜ ê¶Œì¥.',
          severity: 'warning',
        });
      }

      // ê·œì¹™ 3: z-index í‘œì¤€í™” í™•ì¸
      if (/\bz-(?!0|10|20|40|50|60\b)\d+/.test(line)) {
        results.push({
          file,
          line: lineNum,
          issue: `ë¹„í‘œì¤€ z-index ì‚¬ìš©. zIndexClasses ì‚¬ìš© ê¶Œì¥.`,
          severity: 'warning',
        });
      }
    });
  }

  return results;
}

// ì‹¤í–‰
validateLayout().then((results) => {
  if (results.length === 0) {
    console.log('âœ… ëª¨ë“  ë ˆì´ì•„ì›ƒ ê·œì¹™ ì¤€ìˆ˜');
    process.exit(0);
  } else {
    console.log(`âŒ ${results.length}ê°œ ì´ìŠˆ ë°œê²¬:\n`);

    results.forEach((r) => {
      const icon = r.severity === 'error' ? 'ğŸ”´' : 'âš ï¸';
      console.log(`${icon} ${r.file}:${r.line}`);
      console.log(`   ${r.issue}\n`);
    });

    process.exit(1);
  }
});
```

---

## Phase 4: ì•„í‚¤í…ì²˜ ë¦¬íŒ©í† ë§

### 4.1 API í´ë¼ì´ì–¸íŠ¸ ë„ë©”ì¸ ë¶„ë¦¬

#### ì‹ ê·œ í´ë” êµ¬ì¡°: `src/lib/api/`
```
src/lib/api/
â”œâ”€â”€ index.ts         # í†µí•© export
â”œâ”€â”€ client.ts        # ê³µí†µ request ë¡œì§
â”œâ”€â”€ auth.ts          # ì¸ì¦ API
â”œâ”€â”€ users.ts         # ì‚¬ìš©ì API
â”œâ”€â”€ deals.ts         # ê±°ë˜ API
â”œâ”€â”€ payments.ts      # ê²°ì œ API
â”œâ”€â”€ contents.ts      # ì»¨í…ì¸  API
â””â”€â”€ admin.ts         # ê´€ë¦¬ì API
```

#### ì‹ ê·œ íŒŒì¼: `src/lib/api/client.ts`
```typescript
import type { ApiResponse, ApiError } from '@/types/api';

export class ApiClient {
  private baseUrl: string;
  private getToken: () => string | null;

  constructor(baseUrl: string, getToken: () => string | null) {
    this.baseUrl = baseUrl;
    this.getToken = getToken;
  }

  async request<T>(
    endpoint: string,
    options?: RequestInit & { requireAuth?: boolean }
  ): Promise<T> {
    const { requireAuth = true, ...fetchOptions } = options || {};

    const headers: HeadersInit = {
      'Content-Type': 'application/json',
      ...fetchOptions.headers,
    };

    if (requireAuth) {
      const token = this.getToken();
      if (token) {
        headers['Authorization'] = `Bearer ${token}`;
      }
    }

    try {
      const response = await fetch(`${this.baseUrl}${endpoint}`, {
        ...fetchOptions,
        headers,
      });

      if (!response.ok) {
        const error: ApiError = await response.json();
        throw new Error(error.error || `HTTP ${response.status}`);
      }

      return await response.json();
    } catch (error) {
      console.error(`[API Error] ${endpoint}:`, error);
      throw error;
    }
  }

  get<T>(endpoint: string, options?: RequestInit) {
    return this.request<T>(endpoint, { ...options, method: 'GET' });
  }

  post<T>(endpoint: string, data?: unknown, options?: RequestInit) {
    return this.request<T>(endpoint, {
      ...options,
      method: 'POST',
      body: JSON.stringify(data),
    });
  }

  patch<T>(endpoint: string, data?: unknown, options?: RequestInit) {
    return this.request<T>(endpoint, {
      ...options,
      method: 'PATCH',
      body: JSON.stringify(data),
    });
  }

  delete<T>(endpoint: string, options?: RequestInit) {
    return this.request<T>(endpoint, { ...options, method: 'DELETE' });
  }
}
```

#### ì‹ ê·œ íŒŒì¼: `src/lib/api/deals.ts`
```typescript
import type {
  CreateDealRequest,
  CreateDealResponse,
  ListDealsRequest,
  ListDealsResponse,
  GetDealResponse,
} from '@/types/api';
import { ApiClient } from './client';

export class DealsAPI {
  constructor(private client: ApiClient) {}

  async list(params?: ListDealsRequest): Promise<ListDealsResponse> {
    const query = new URLSearchParams(params as any).toString();
    return this.client.get<ListDealsResponse>(`/deals?${query}`);
  }

  async get(dealId: string): Promise<GetDealResponse> {
    return this.client.get<GetDealResponse>(`/deals/${dealId}`);
  }

  async create(data: CreateDealRequest): Promise<CreateDealResponse> {
    return this.client.post<CreateDealResponse>('/deals', data);
  }

  async cancel(dealId: string): Promise<void> {
    return this.client.post<void>(`/deals/${dealId}/cancel`);
  }
}
```

#### ì‹ ê·œ íŒŒì¼: `src/lib/api/index.ts`
```typescript
import { ApiClient } from './client';
import { AuthAPI } from './auth';
import { UsersAPI } from './users';
import { DealsAPI } from './deals';
import { PaymentsAPI } from './payments';
import { ContentsAPI } from './contents';
import { AdminAPI } from './admin';
import { serverEnv } from '../validateEnv';

// Token ê´€ë¦¬
const getToken = () => {
  if (typeof window === 'undefined') return null;
  return localStorage.getItem('authToken');
};

// API í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤
const client = new ApiClient(serverEnv.API_BASE_URL, getToken);

// í†µí•© API ê°ì²´
export const api = {
  auth: new AuthAPI(client),
  users: new UsersAPI(client),
  deals: new DealsAPI(client),
  payments: new PaymentsAPI(client),
  contents: new ContentsAPI(client),
  admin: new AdminAPI(client),
};

// ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•œ ì§ì ‘ export
export { ApiClient };
```

---

### 4.2 ê±°ë˜ ìƒì„± í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬

#### ì‹ ê·œ í´ë” êµ¬ì¡°: `src/components/deal/steps/`
```
src/components/deal/steps/
â”œâ”€â”€ index.ts
â”œâ”€â”€ TypeStep.tsx          # Step 1: ì†¡ê¸ˆ ìœ í˜• ì„ íƒ
â”œâ”€â”€ AmountStep.tsx        # Step 2: ê¸ˆì•¡ ì…ë ¥
â”œâ”€â”€ RecipientStep.tsx     # Step 3: ë°›ëŠ” ì‚¬ëŒ ì •ë³´
â”œâ”€â”€ FilesStep.tsx         # Step 4: íŒŒì¼ ì²¨ë¶€
â””â”€â”€ types.ts              # ê³µí†µ íƒ€ì…
```

#### ì‹ ê·œ íŒŒì¼: `src/components/deal/steps/types.ts`
```typescript
export interface DealFormData {
  type: 'personal' | 'business' | null;
  amount: number;
  recipientName: string;
  recipientPhone: string;
  recipientBankCode: string;
  recipientAccount: string;
  businessNumber: string;
  files: string[];
}

export interface StepProps {
  data: DealFormData;
  onChange: (updates: Partial<DealFormData>) => void;
  onNext: () => void;
  onBack: () => void;
}
```

#### ì‹ ê·œ íŒŒì¼: `src/components/deal/steps/TypeStep.tsx`
```typescript
'use client';

import { StepProps } from './types';

export function TypeStep({ data, onChange, onNext }: StepProps) {
  const handleSelectType = (type: 'personal' | 'business') => {
    onChange({ type });
    setTimeout(onNext, 300); // ì„ íƒ í›„ ìë™ ì§„í–‰
  };

  return (
    <div className="px-5 py-6">
      <h2 className="text-xl font-bold mb-2">ì†¡ê¸ˆ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
      <p className="text-gray-500 text-sm mb-6">
        ê°œì¸ ê°„ ì†¡ê¸ˆì€ ìˆ˜ìˆ˜ë£Œê°€ ë” ì €ë ´í•©ë‹ˆë‹¤
      </p>

      <div className="space-y-3">
        <button
          onClick={() => handleSelectType('personal')}
          className={`w-full p-5 rounded-xl border-2 transition-all ${
            data.type === 'personal'
              ? 'border-primary-400 bg-primary-50'
              : 'border-gray-200 hover:border-gray-300'
          }`}
        >
          <div className="flex items-center justify-between">
            <div className="text-left">
              <div className="font-semibold text-lg">ê°œì¸ ì†¡ê¸ˆ</div>
              <div className="text-sm text-gray-500 mt-1">
                ê°€ì¡±, ì¹œêµ¬ì—ê²Œ ì†¡ê¸ˆ (ìˆ˜ìˆ˜ë£Œ 1.5%)
              </div>
            </div>
          </div>
        </button>

        <button
          onClick={() => handleSelectType('business')}
          className={`w-full p-5 rounded-xl border-2 transition-all ${
            data.type === 'business'
              ? 'border-primary-400 bg-primary-50'
              : 'border-gray-200 hover:border-gray-300'
          }`}
        >
          <div className="flex items-center justify-between">
            <div className="text-left">
              <div className="font-semibold text-lg">ì‚¬ì—…ì ì†¡ê¸ˆ</div>
              <div className="text-sm text-gray-500 mt-1">
                ì‚¬ì—…ìì—ê²Œ ì†¡ê¸ˆ (ìˆ˜ìˆ˜ë£Œ 2.5% + ì„œë¥˜ í•„ìš”)
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>
  );
}
```

#### ë³€ê²½ íŒŒì¼: `src/app/(customer)/deals/new/page.tsx`

**ë³€ê²½ ì „** (1400ì¤„ ë‹¨ì¼ ì»´í¬ë„ŒíŠ¸):
```tsx
export default function NewDealPage() {
  const [step, setStep] = useState(1);
  const [type, setType] = useState<'personal' | 'business' | null>(null);
  const [amount, setAmount] = useState('');
  // ... ìˆ˜ë§ì€ ìƒíƒœë“¤

  return (
    <div>
      {/* Step 1 */}
      {step === 1 && <div>...</div>}

      {/* Step 2 */}
      {step === 2 && <div>...</div>}

      {/* ... 400ì¤„ì”© 4ê°œ Step */}
    </div>
  );
}
```

**ë³€ê²½ í›„** (ë¶„ë¦¬ëœ ì»´í¬ë„ŒíŠ¸):
```tsx
'use client';

import { useState } from 'react';
import { TypeStep, AmountStep, RecipientStep, FilesStep } from '@/components/deal/steps';
import type { DealFormData } from '@/components/deal/steps/types';
import { Header } from '@/components/common';

export default function NewDealPage() {
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState<DealFormData>({
    type: null,
    amount: 0,
    recipientName: '',
    recipientPhone: '',
    recipientBankCode: '',
    recipientAccount: '',
    businessNumber: '',
    files: [],
  });

  const handleChange = (updates: Partial<DealFormData>) => {
    setFormData((prev) => ({ ...prev, ...updates }));
  };

  const handleNext = () => setStep((prev) => prev + 1);
  const handleBack = () => setStep((prev) => prev - 1);

  const stepProps = {
    data: formData,
    onChange: handleChange,
    onNext: handleNext,
    onBack: handleBack,
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <Header title="ìƒˆ ì†¡ê¸ˆ" showBack />

      {/* Progress Bar */}
      <div className="h-1 bg-gray-200">
        <div
          className="h-full bg-primary-400 transition-all"
          style={{ width: `${(step / 4) * 100}%` }}
        />
      </div>

      {/* Step Rendering */}
      {step === 1 && <TypeStep {...stepProps} />}
      {step === 2 && <AmountStep {...stepProps} />}
      {step === 3 && <RecipientStep {...stepProps} />}
      {step === 4 && <FilesStep {...stepProps} />}
    </div>
  );
}
```

---

### 4.3 ì¤‘ë³µ ì½”ë“œ ìœ í‹¸ë¦¬í‹° ì¶”ì¶œ

#### ì‹ ê·œ íŒŒì¼: `src/lib/utils/userUtils.ts`
```typescript
import type { IUser } from '@/types/user';

/**
 * API ì‘ë‹µì„ IUser íƒ€ì…ìœ¼ë¡œ ë³€í™˜
 */
export function mapApiUserToIUser(apiUser: any): IUser {
  return {
    uid: apiUser.uid || apiUser.id,
    name: apiUser.name,
    phone: apiUser.phone,
    email: apiUser.email || null,
    status: apiUser.status || 'pending',
    grade: apiUser.grade || 'bronze',
    bankCode: apiUser.bankCode || null,
    accountNumber: apiUser.accountNumber || null,
    accountVerified: apiUser.accountVerified || false,
    totalDealAmount: apiUser.totalDealAmount || 0,
    totalDealCount: apiUser.totalDealCount || 0,
    agreeTerms: apiUser.agreeTerms || false,
    agreePrivacy: apiUser.agreePrivacy || false,
    agreeMarketing: apiUser.agreeMarketing || false,
    createdAt: apiUser.createdAt,
    updatedAt: apiUser.updatedAt || apiUser.createdAt,
  };
}
```

#### ë³€ê²½ íŒŒì¼: `src/stores/useUserStore.ts`

**ì¤‘ë³µ ì œê±°**:
```typescript
import { mapApiUserToIUser } from '@/lib/utils/userUtils';

export const useUserStore = create<IUserStore>()(
  persist(
    (set, get) => ({
      // ...

      login: async (phone: string, password?: string) => {
        try {
          const response = await api.auth.login({ phone });
          const user = mapApiUserToIUser(response.user); // âœ… ì¤‘ë³µ ì œê±°

          localStorage.setItem('authToken', response.token);
          set({ currentUser: user });
        } catch (error) {
          console.error('Login failed:', error);
        }
      },

      fetchCurrentUser: async () => {
        try {
          const response = await api.users.getMe();
          const user = mapApiUserToIUser(response); // âœ… ì¤‘ë³µ ì œê±°

          set({ currentUser: user });
        } catch (error) {
          console.error('Fetch user failed:', error);
        }
      },
    }),
    // ...
  )
);
```

---

## Phase 5: ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ 

### 5.1 ìƒìˆ˜ íŒŒì¼ë¡œ ë§¤ì§ ë„˜ë²„ ì´ë™

#### ì‹ ê·œ íŒŒì¼: `src/lib/constants.ts`
```typescript
/**
 * í”„ë¡œì íŠ¸ ì „ì—­ ìƒìˆ˜
 */

// ===== ê±°ë˜ ê´€ë ¨ =====

export const DEAL_LIMITS = {
  MIN_AMOUNT: 10_000,
  MAX_AMOUNT_BRONZE: 1_000_000,
  MAX_AMOUNT_SILVER: 3_000_000,
  MAX_AMOUNT_GOLD: 5_000_000,
  MAX_AMOUNT_PLATINUM: 10_000_000,
  MAX_FILES: 10,
  MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
} as const;

export const DEAL_STATUS = {
  PENDING: 'pending',
  PAYMENT_COMPLETED: 'payment_completed',
  PROCESSING: 'processing',
  COMPLETED: 'completed',
  CANCELLED: 'cancelled',
  FAILED: 'failed',
} as const;

// ===== ìˆ˜ìˆ˜ë£Œìœ¨ =====

export const FEE_RATES = {
  PERSONAL: 0.015, // 1.5%
  BUSINESS: 0.025, // 2.5%
} as const;

// ===== ë“±ê¸‰ ì„¤ì • =====

export const GRADE_CONFIG = {
  bronze: {
    name: 'ë¸Œë¡ ì¦ˆ',
    color: '#CD7F32',
    feeRate: 0.015,
    monthlyLimit: 1_000_000,
    perDealLimit: 1_000_000,
  },
  silver: {
    name: 'ì‹¤ë²„',
    color: '#C0C0C0',
    feeRate: 0.012,
    monthlyLimit: 3_000_000,
    perDealLimit: 3_000_000,
  },
  gold: {
    name: 'ê³¨ë“œ',
    color: '#FFD700',
    feeRate: 0.01,
    monthlyLimit: 5_000_000,
    perDealLimit: 5_000_000,
  },
  platinum: {
    name: 'í”Œë˜í‹°ë„˜',
    color: '#E5E4E2',
    feeRate: 0.008,
    monthlyLimit: 10_000_000,
    perDealLimit: 10_000_000,
  },
} as const;

// ===== ì€í–‰ ì½”ë“œ =====

export const BANKS = [
  { code: '001', name: 'í•œêµ­ì€í–‰' },
  { code: '002', name: 'ì‚°ì—…ì€í–‰' },
  { code: '003', name: 'ê¸°ì—…ì€í–‰' },
  { code: '004', name: 'KBêµ­ë¯¼ì€í–‰' },
  { code: '011', name: 'NHë†í˜‘ì€í–‰' },
  { code: '020', name: 'ìš°ë¦¬ì€í–‰' },
  { code: '023', name: 'SCì œì¼ì€í–‰' },
  { code: '027', name: 'í•œêµ­ì”¨í‹°ì€í–‰' },
  { code: '031', name: 'ëŒ€êµ¬ì€í–‰' },
  { code: '032', name: 'ë¶€ì‚°ì€í–‰' },
  { code: '034', name: 'ê´‘ì£¼ì€í–‰' },
  { code: '035', name: 'ì œì£¼ì€í–‰' },
  { code: '037', name: 'ì „ë¶ì€í–‰' },
  { code: '039', name: 'ê²½ë‚¨ì€í–‰' },
  { code: '045', name: 'ìƒˆë§ˆì„ê¸ˆê³ ' },
  { code: '048', name: 'ì‹ í˜‘' },
  { code: '050', name: 'ì €ì¶•ì€í–‰' },
  { code: '071', name: 'ìš°ì²´êµ­' },
  { code: '081', name: 'KEBí•˜ë‚˜ì€í–‰' },
  { code: '088', name: 'ì‹ í•œì€í–‰' },
  { code: '089', name: 'ì¼€ì´ë±…í¬' },
  { code: '090', name: 'ì¹´ì¹´ì˜¤ë±…í¬' },
  { code: '092', name: 'í† ìŠ¤ë±…í¬' },
] as const;

// ===== UI ê´€ë ¨ =====

export const MOBILE_FRAME = {
  WIDTH: 375,
  HEIGHT: 812,
} as const;

export const ANIMATION_DURATION = {
  FAST: 150,
  NORMAL: 300,
  SLOW: 500,
} as const;
```

---

### 5.2 ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€

#### ì‹ ê·œ íŒŒì¼: `src/lib/errorHandler.ts`
```typescript
/**
 * í†µí•© ì—ëŸ¬ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹°
 */

export class AppError extends Error {
  constructor(
    public code: string,
    public message: string,
    public statusCode: number = 500,
    public details?: unknown
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export function logError(error: unknown, context?: string): void {
  const timestamp = new Date().toISOString();
  const contextStr = context ? `[${context}]` : '';

  if (error instanceof AppError) {
    console.error(`${timestamp} ${contextStr} AppError [${error.code}]:`, {
      message: error.message,
      statusCode: error.statusCode,
      details: error.details,
    });
  } else if (error instanceof Error) {
    console.error(`${timestamp} ${contextStr} Error:`, {
      name: error.name,
      message: error.message,
      stack: error.stack,
    });
  } else {
    console.error(`${timestamp} ${contextStr} Unknown error:`, error);
  }
}

export function handleApiError(error: unknown, defaultMessage: string): string {
  if (error instanceof AppError) {
    return error.message;
  }

  if (error instanceof Error) {
    return error.message || defaultMessage;
  }

  return defaultMessage;
}
```

#### ëª¨ë“  ë¹ˆ catch ë¸”ë¡ ìˆ˜ì •
```typescript
// âŒ ë³€ê²½ ì „
try {
  // ...
} catch {
  // ë¬´ì‹œ
}

// âœ… ë³€ê²½ í›„
try {
  // ...
} catch (error) {
  logError(error, 'ContextName');
  // í•„ìš” ì‹œ ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
}
```

---

### 5.3 ESLint ê·œì¹™ ê°•í™”

#### ì‹ ê·œ íŒŒì¼: `.eslintrc.json`
```json
{
  "extends": ["next/core-web-vitals"],
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": ["warn", {
      "argsIgnorePattern": "^_",
      "varsIgnorePattern": "^_"
    }],
    "no-console": ["warn", {
      "allow": ["warn", "error"]
    }],
    "no-debugger": "error",
    "prefer-const": "error",
    "no-var": "error"
  }
}
```

---

## êµ¬í˜„ ìˆœì„œ

### ì „ì²´ ìˆœì„œ (Phaseë³„ ì§„í–‰)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Critical ë³´ì•ˆ ì´ìŠˆ (1ì¼)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1.1 validateEnv.ts ìƒì„±                                         â”‚
â”‚ 1.2 .env.example ìƒì„±                                           â”‚
â”‚ 1.3 useAdminStore.ts ë¹„ë°€ë²ˆí˜¸ ì œê±° + API ì¸ì¦ìœ¼ë¡œ ë³€ê²½         â”‚
â”‚ 1.4 api/admin/auth/login/route.ts ìƒì„±                         â”‚
â”‚ 1.5 api.ts API_BASE_URL í™˜ê²½ë³€ìˆ˜í™”                             â”‚
â”‚ 1.6 auth/middleware.ts ìƒì„±                                     â”‚
â”‚ 1.7 ê²°ì œ API ë¼ìš°íŠ¸ì— requireAuth ì ìš©                         â”‚
â”‚ 1.8 ìˆ˜ë™ í…ŒìŠ¤íŠ¸: ê´€ë¦¬ì ë¡œê·¸ì¸, ê²°ì œ API ì¸ì¦                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: TypeScript Strict ëª¨ë“œ (1-2ì¼)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2.1 types/api.ts ìƒì„± (ëª¨ë“  API íƒ€ì…)                          â”‚
â”‚ 2.2 lib/api/*.ts ë¶„ë¦¬ (ë„ë©”ì¸ë³„)                               â”‚
â”‚ 2.3 tsconfig.json strict: true í™œì„±í™”                          â”‚
â”‚ 2.4 ì»´íŒŒì¼ ì—ëŸ¬ ìˆ˜ì • (ë°˜ë³µ)                                    â”‚
â”‚   - any íƒ€ì… ì œê±°                                               â”‚
â”‚   - null/undefined ì²´í¬ ì¶”ê°€                                    â”‚
â”‚   - íƒ€ì… ê°€ë“œ ì¶”ê°€                                              â”‚
â”‚ 2.5 Store íƒ€ì… ê°•í™”                                             â”‚
â”‚ 2.6 tsc --noEmit ì„±ê³µ í™•ì¸                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: ëª¨ë°”ì¼ UI ë ˆì´ì•„ì›ƒ (0.5ì¼)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3.1 lib/zIndex.ts ìƒì„±                                          â”‚
â”‚ 3.2 deals/new/page.tsx fixed â†’ absolute ìˆ˜ì •                   â”‚
â”‚ 3.3 ëª¨ë“  z-indexë¥¼ zIndexClassesë¡œ êµì²´                        â”‚
â”‚ 3.4 scripts/validate-layout.ts ìƒì„±                            â”‚
â”‚ 3.5 npm run validate:layout ì‹¤í–‰ ë° ìˆ˜ì •                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 4: ì•„í‚¤í…ì²˜ ë¦¬íŒ©í† ë§ (2-3ì¼)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4.1 lib/api/ í´ë” êµ¬ì¡° ìƒì„±                                     â”‚
â”‚ 4.2 lib/api/client.ts ìƒì„± (ê³µí†µ ë¡œì§)                         â”‚
â”‚ 4.3 lib/api/*.ts ë„ë©”ì¸ë³„ API ë¶„ë¦¬                             â”‚
â”‚ 4.4 lib/api/index.ts í†µí•© export                               â”‚
â”‚ 4.5 components/deal/steps/ í´ë” ìƒì„±                           â”‚
â”‚ 4.6 ê° Step ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬                                       â”‚
â”‚ 4.7 deals/new/page.tsx ë¦¬íŒ©í† ë§                                â”‚
â”‚ 4.8 lib/utils/userUtils.ts ìƒì„±                                â”‚
â”‚ 4.9 ì¤‘ë³µ ì½”ë“œ ìœ í‹¸ë¦¬í‹°ë¡œ êµì²´                                  â”‚
â”‚ 4.10 ìˆ˜ë™ í…ŒìŠ¤íŠ¸: ì „ì²´ í”Œë¡œìš° ê²€ì¦                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 5: ìœ ì§€ë³´ìˆ˜ì„± ê°œì„  (1ì¼)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5.1 lib/constants.ts ìƒì„±                                       â”‚
â”‚ 5.2 ë§¤ì§ ë„˜ë²„/ë¬¸ìì—´ì„ constantsë¡œ ì´ë™                        â”‚
â”‚ 5.3 lib/errorHandler.ts ìƒì„±                                    â”‚
â”‚ 5.4 ëª¨ë“  ë¹ˆ catch ë¸”ë¡ì— logError ì¶”ê°€                         â”‚
â”‚ 5.5 .eslintrc.json ìƒì„±                                         â”‚
â”‚ 5.6 npm run lint ì‹¤í–‰ ë° ìˆ˜ì •                                   â”‚
â”‚ 5.7 ìµœì¢… ì½”ë“œ í’ˆì§ˆ ë¶„ì„ (bkit:code-analyzer)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê²€ì¦ ë°©ë²•

### Phase 1 ê²€ì¦
```bash
# í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
npm run dev
# â†’ ëˆ„ë½ëœ í™˜ê²½ ë³€ìˆ˜ ì—ëŸ¬ í™•ì¸

# ê´€ë¦¬ì ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:3000/api/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin1234"}'

# ê²°ì œ API ì¸ì¦ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:3000/api/payments/billing-key/pay \
  -H "Content-Type: application/json"
# â†’ 401 Unauthorized í™•ì¸ (í† í° ì—†ìŒ)
```

### Phase 2 ê²€ì¦
```bash
# TypeScript ì»´íŒŒì¼ ì²´í¬
npm run type-check  # or tsc --noEmit

# any íƒ€ì… ê²€ìƒ‰
grep -r "any" src/lib/api/*.ts
# â†’ 0ê°œ ê²°ê³¼ í™•ì¸

# ë¹Œë“œ í…ŒìŠ¤íŠ¸
npm run build
```

### Phase 3 ê²€ì¦
```bash
# ë ˆì´ì•„ì›ƒ ê·œì¹™ ê²€ì¦
npm run validate:layout

# ìˆ˜ë™ í…ŒìŠ¤íŠ¸: ê±°ë˜ ìƒì„± í”Œë¡œìš°
# â†’ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ì´ ëª¨ë°”ì¼ í”„ë ˆì„ ë‚´ë¶€ì—ë§Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
```

### Phase 4 ê²€ì¦
```bash
# íŒŒì¼ ì¤„ ìˆ˜ í™•ì¸
wc -l src/lib/api.ts          # â†’ ì¡´ì¬í•˜ì§€ ì•Šì•„ì•¼ í•¨
wc -l src/lib/api/*.ts        # â†’ ê° íŒŒì¼ 300ì¤„ ì´í•˜
wc -l src/app/(customer)/deals/new/page.tsx  # â†’ 300ì¤„ ì´í•˜

# ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
# 1. ë¡œê·¸ì¸
# 2. ê±°ë˜ ìƒì„± (4ë‹¨ê³„)
# 3. ê²°ì œ
# 4. ê±°ë˜ ë‚´ì—­ í™•ì¸
```

### Phase 5 ê²€ì¦
```bash
# ë§¤ì§ ë„˜ë²„ ê²€ìƒ‰
grep -r "10000\|1000000" src/
# â†’ constants.tsë§Œ ë‚˜ì™€ì•¼ í•¨

# ë¹ˆ catch ë¸”ë¡ ê²€ìƒ‰
grep -r "catch\s*{" src/
# â†’ 0ê°œ ê²°ê³¼

# ìµœì¢… ì½”ë“œ í’ˆì§ˆ ë¶„ì„
# bkit:code-analyzer ì¬ì‹¤í–‰
# â†’ 85+ ì ìˆ˜ í™•ì¸
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### Store Persist ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

#### useUserStore ë²„ì „ ì—…ê·¸ë ˆì´ë“œ
```typescript
export const useUserStore = create<IUserStore>()(
  persist(
    (set, get) => ({ /* ... */ }),
    {
      name: 'user-storage',
      version: 2, // âœ… ë²„ì „ ì¦ê°€
      migrate: (persistedState: unknown, version: number): PersistedUserState => {
        // v1 â†’ v2 ë§ˆì´ê·¸ë ˆì´ì…˜
        if (version === 1) {
          const oldState = persistedState as any;

          return {
            currentUser: oldState.currentUser
              ? mapApiUserToIUser(oldState.currentUser)
              : null,
            users: (oldState.users || []).map(mapApiUserToIUser),
            _hasHydrated: false,
          };
        }

        // ê¸°ë³¸ê°’
        return {
          currentUser: null,
          users: [],
          _hasHydrated: false,
        };
      },
    }
  )
);
```

---

## ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 ë°°í¬ ì „ í•„ìˆ˜
- [ ] `.env` íŒŒì¼ì— ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] `ADMIN_SECRET_KEY` 32ì ì´ìƒ ê°•ë ¥í•œ í‚¤ë¡œ ì„¤ì •
- [ ] API_BASE_URL í”„ë¡œë•ì…˜ URLë¡œ ì„¤ì •
- [ ] ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ í•´ì‹œê°’ ê²€ì¦
- [ ] ê²°ì œ API ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ë™ì‘ í™•ì¸

### Phase 2-5 ë°°í¬ ì „
- [ ] `tsc --noEmit` ì„±ê³µ
- [ ] `npm run build` ì„±ê³µ
- [ ] ëª¨ë“  í˜ì´ì§€ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë¡œê·¸ì¸/íšŒì›ê°€ì… í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] ê±°ë˜ ìƒì„± í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] ê²°ì œ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] ê´€ë¦¬ì í˜ì´ì§€ í…ŒìŠ¤íŠ¸

---

**Design ë¬¸ì„œ ì‘ì„± ì™„ë£Œ**: 2026-01-31
**ë‹¤ìŒ ë‹¨ê³„**: Do Phase - êµ¬í˜„ ì‹œì‘ (`/pdca do í”„ë¡œì íŠ¸-êµ¬ì¡°-ì•ˆì •í™”`)
