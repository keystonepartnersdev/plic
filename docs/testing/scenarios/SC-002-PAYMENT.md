# SC-002: 결제 플로우 시나리오

> 거래 결제 및 상태 전이 테스트

---

## 기본 정보

| 항목 | 값 |
|------|-----|
| 시나리오 ID | SC-002 |
| 기능 | 카드 결제 및 상태 전이 |
| 우선순위 | Critical |
| 예상 TC 수 | 8 |
| 상태 | ✅ 완료 (2026-02-04) |

---

## 사전 조건

- [ ] SC-001 완료 (거래 생성됨)
- [ ] 거래 상태: `awaiting_payment`
- [ ] 테스트 카드 정보 준비

---

## 테스트 케이스

### TC-002-01: 결제 페이지 접근

| 항목 | 내용 |
|------|------|
| 목적 | 결제대기 거래에서 결제 페이지 진입 |
| 사전조건 | 거래 상태가 `awaiting_payment` |
| 기대결과 | 결제 페이지 정상 표시 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | 거래 상세 페이지 접속 | `/deals/{did}` | 거래 정보 표시 | | ⬜ |
| 2 | "결제하기" 버튼 확인 | - | 버튼 활성화 | | ⬜ |
| 3 | 버튼 클릭 | - | `/payment/{did}` 이동 | | ⬜ |
| 4 | 결제 정보 확인 | - | 금액, 수수료, 총액 표시 | | ⬜ |

---

### TC-002-02: 신규 카드 결제

| 항목 | 내용 |
|------|------|
| 목적 | 새 카드로 결제 진행 |
| 사전조건 | 결제 페이지 접속 |
| 기대결과 | 결제 성공 및 상태 전이 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | "새 카드로 결제" 선택 | - | 카드 입력 폼 표시 | | ⬜ |
| 2 | 카드번호 입력 | 4111111111111111 | 포맷팅 적용 | | ⬜ |
| 3 | 유효기간 입력 | 12/28 | 입력됨 | | ⬜ |
| 4 | CVC 입력 | 123 | 입력됨 | | ⬜ |
| 5 | 생년월일 입력 | 900101 | 입력됨 | | ⬜ |
| 6 | 비밀번호 앞 2자리 | 12 | 입력됨 | | ⬜ |
| 7 | "결제하기" 클릭 | - | 결제 처리 중 | | ⬜ |
| 8 | 결제 완료 | - | 결과 페이지 이동 | | ⬜ |

**검증 포인트:**
- 결제 성공 시 거래 상태: `payment_completed`
- 결제 정보 저장 확인
- 결제 영수증/확인 정보 표시

---

### TC-002-03: 등록된 카드로 결제

| 항목 | 내용 |
|------|------|
| 목적 | 기등록 카드(빌링키)로 간편 결제 |
| 사전조건 | 등록된 카드가 있음 |
| 기대결과 | 간편 결제 성공 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | 등록 카드 목록 확인 | - | 카드 목록 표시 | | ⬜ |
| 2 | 카드 선택 | 첫 번째 카드 | 선택됨 표시 | | ⬜ |
| 3 | "결제하기" 클릭 | - | 결제 처리 | | ⬜ |
| 4 | 결제 완료 | - | 성공 메시지 | | ⬜ |

---

### TC-002-04: 결제 실패 케이스

| 항목 | 내용 |
|------|------|
| 목적 | 결제 실패 시 에러 처리 확인 |
| 사전조건 | 결제 페이지 접속 |
| 기대결과 | 적절한 에러 메시지 표시 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | 잘못된 카드번호 | 1234123412341234 | 카드 오류 메시지 | | ⬜ |
| 2 | 만료된 유효기간 | 01/20 | 유효기간 오류 | | ⬜ |
| 3 | 잘못된 CVC | 12 (2자리) | CVC 오류 | | ⬜ |
| 4 | 한도 초과 카드 | - | 한도 초과 메시지 | | ⬜ |

---

### TC-002-05: 결제 후 상태 전이

| 항목 | 내용 |
|------|------|
| 목적 | 결제 완료 후 거래 상태 변경 확인 |
| 사전조건 | 결제 성공 |
| 기대결과 | 상태가 `payment_completed`로 변경 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | 결제 완료 후 거래 상세 | - | 상태: 결제완료 | | ⬜ |
| 2 | 거래내역 목록 확인 | - | 상태 업데이트됨 | | ⬜ |
| 3 | `isPaid` 플래그 | - | true | | ⬜ |
| 4 | `paidAt` 타임스탬프 | - | 현재 시간 기록 | | ⬜ |

---

### TC-002-06: 결제 취소

| 항목 | 내용 |
|------|------|
| 목적 | 결제 후 취소 가능 여부 확인 |
| 사전조건 | 결제 완료된 거래 |
| 기대결과 | 취소 정책에 따른 처리 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | 거래 상세에서 취소 요청 | - | 취소 가능 여부 확인 | | ⬜ |
| 2 | 취소 사유 입력 | "단순 변심" | 입력됨 | | ⬜ |
| 3 | 취소 확인 | - | 상태: `cancelled` | | ⬜ |

---

### TC-002-07: 결제 결과 페이지

| 항목 | 내용 |
|------|------|
| 목적 | 결제 결과 페이지 정보 확인 |
| 사전조건 | 결제 프로세스 완료 |
| 기대결과 | 결과 정보 정확히 표시 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | `/payment/result` 접속 | - | 결제 결과 표시 | | ⬜ |
| 2 | 결제 금액 확인 | - | 실제 결제 금액 | | ⬜ |
| 3 | 거래 정보 확인 | - | 거래 ID, 수취인 등 | | ⬜ |
| 4 | "거래내역 보기" 클릭 | - | 거래 상세 이동 | | ⬜ |

---

### TC-002-08: 결제대기 타임아웃

| 항목 | 내용 |
|------|------|
| 목적 | 결제대기 시간 초과 시 처리 확인 |
| 사전조건 | 거래 생성 후 7일 경과 |
| 기대결과 | 자동 취소 또는 만료 처리 |

**테스트 단계:**

| # | 동작 | 입력값 | 기대 결과 | 실제 결과 | Pass/Fail |
|---|------|--------|----------|----------|-----------|
| 1 | 7일 이상 된 결제대기 거래 확인 | - | 상태 확인 | | ⬜ |
| 2 | 결제 시도 | - | 만료 메시지 또는 자동 취소 | | ⬜ |

---

## 테스트 결과 요약

| TC ID | TC명 | 결과 | 버그 ID |
|-------|------|------|---------|
| TC-002-01 | 결제 페이지 접근 | ⬜ | |
| TC-002-02 | 신규 카드 결제 | ⬜ | |
| TC-002-03 | 등록된 카드로 결제 | ⬜ | |
| TC-002-04 | 결제 실패 케이스 | ⬜ | |
| TC-002-05 | 결제 후 상태 전이 | ⬜ | |
| TC-002-06 | 결제 취소 | ⬜ | |
| TC-002-07 | 결제 결과 페이지 | ⬜ | |
| TC-002-08 | 결제대기 타임아웃 | ⬜ | |

**총계**: 0/8 Pass

---

## 관련 파일

- `src/app/(customer)/payment/[did]/page.tsx`
- `src/app/(customer)/payment/result/page.tsx`
- `src/stores/usePaymentStore.ts`

---

## 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|----------|--------|
| 2026-02-04 | 최초 작성 | Claude |
