# PLIC 의사결정 로그

> **목적**: 설계 결정의 근거 추적
> **중요**: 이 문서는 새 세션이 "왜?"를 이해하는 핵심 자료입니다

### 관련 핵심 문서
| 문서 | 설명 |
|------|------|
| [core/ARCHITECTURE.md](./core/ARCHITECTURE.md) | 전체 시스템 구조 |
| **[core/DEAL-TYPES.md](./core/DEAL-TYPES.md)** | 거래 타입 정의서 |
| [core/REGISTRY.md](./core/REGISTRY.md) | 함수/클래스 위치 찾기 |

---

## [2026-02-02] 리팩토링 계획 수립

### 결정
코드 리뷰 결과 발견된 보안/품질 이슈를 6단계로 나누어 체계적으로 개선

### 근거
1. **보안 이슈 심각성**
   - 어드민 비밀번호 하드코딩 (Critical)
   - 클라이언트 사이드 인증 (Critical)
   - JWT localStorage 저장 (High)

2. **기술 부채 누적**
   - TypeScript strict 모드 비활성화
   - any 타입 161개 사용
   - 대형 컴포넌트 (1000줄+) 3개

3. **유지보수 비용 증가**
   - 중복 코드 다수
   - 하드코딩된 설정값
   - useEffect 의존성 누락

### 결정 내용
| Phase | 내용 | 우선순위 |
|-------|------|----------|
| 1 | 보안 강화 (인증 재구현) | Critical |
| 2 | 설정 중앙화 | High |
| 3 | 컴포넌트 분할 | Medium |
| 4 | 중복 코드 제거 | Medium |
| 5 | TypeScript strict 모드 | Medium |
| 6 | 코드 품질 개선 | Low |

### 결정자
- 코드 리뷰 분석 기반 (2026-02-02)

---

## [2026-02-02] 모바일 프레임 레이아웃 채택

### 결정
데스크톱에서도 모바일 프레임(375px x 812px) 내부에 UI를 렌더링하는 "Fitpetmall 스타일" 레이아웃 사용

### 근거
1. **타겟 사용자 경험**
   - 주 사용자가 모바일에서 접근
   - 데스크톱에서도 익숙한 모바일 UX 제공
   - 반응형 대신 고정 프레임으로 일관성 확보

2. **개발 효율성**
   - 하나의 레이아웃만 관리
   - 디바이스별 분기 최소화
   - QA 범위 축소

3. **마케팅 활용**
   - 좌측 50%에 마케팅 패널 배치
   - 브랜딩/프로모션 노출 공간 확보

### 기각된 대안
| 대안 | 기각 이유 |
|------|----------|
| 완전 반응형 | 레이아웃 복잡도 증가, QA 부담 |
| 모바일 전용 | 데스크톱 사용자 경험 저하 |

### 결정자
- 초기 설계 시 결정 (CLAUDE.md에 명시)

---

## [2026-02-02] Zustand persist 전역 사용

### 결정
모든 Zustand 스토어에 persist middleware 적용하여 localStorage에 상태 저장

### 근거
1. **오프라인 지원**
   - 네트워크 불안정 시에도 사용자 데이터 유지
   - 새로고침 후에도 상태 복원

2. **UX 개선**
   - 거래 임시저장 기능 자연스럽게 구현
   - 로그인 상태 유지

3. **개발 단순화**
   - 서버 사이드 세션 관리 불필요 (초기 단계)
   - 빠른 프로토타이핑 가능

### 부작용 및 완화
| 부작용 | 완화 방안 |
|--------|----------|
| 보안 (토큰 노출) | Phase 1에서 httpOnly 쿠키로 전환 |
| 용량 제한 | 불필요한 데이터 정리 로직 추가 |
| 동기화 이슈 | 서버 데이터와 병합 로직 구현 |

### 결정자
- 초기 설계 시 결정

---

## [2026-02-02] 12개 거래 타입 정의

### 결정
B2B 송금 서비스에 적합한 12개 거래 타입 정의

### 근거
1. **실무 기반 분류**
   - 실제 사업자가 사용하는 지출 카테고리 분석
   - 세금계산서/증빙 서류와 연계 고려

2. **서류 검증 효율화**
   - 타입별 필수 서류 명확화
   - 관리자 검토 기준 표준화

3. **확장 가능성**
   - `other` 타입으로 예외 케이스 처리
   - 향후 타입 추가 용이한 구조

### 타입 목록
```
물품구매, 인건비, 서비스이용료, 공사대금, 임차료,
물류비, 광고마케팅, 장비구매, 유지보수, 컨설팅,
기타, 미지정
```

### 결정자
- 비즈니스 요구사항 분석 기반

---

## [2026-02-02] 등급별 수수료 차등화

### 결정
사용자 등급에 따라 수수료율과 월 한도를 차등 적용

### 근거
1. **수익 모델**
   - 수수료 기반 BM
   - 등급 업그레이드 유인 제공

2. **고객 가치 기반 요금제**
   - 높은 거래량 고객에게 우대 조건
   - 사업자(B2B)에게 추가 혜택

3. **리스크 관리**
   - 신규 고객은 낮은 한도로 시작
   - 검증된 고객에게 한도 확대

### 등급 체계
| 등급 | 수수료 | 월 한도 | 조건 |
|------|--------|--------|------|
| basic | 5.5% | 2,000만원 | 기본 |
| platinum | 4.5% | 5,000만원 | 일정 거래량 달성 |
| b2b | 3.5% | 1억원 | 사업자 인증 |
| employee | 0% | - | 내부 직원 |

### 결정자
- 비즈니스 전략 기반

---

## [2026-02-04] JWT httpOnly Cookie 마이그레이션 완료

### 결정
JWT 토큰 저장 방식을 localStorage에서 httpOnly Cookie로 전환

### 근거
1. **보안 강화**
   - XSS 공격으로부터 토큰 보호
   - JavaScript에서 토큰 직접 접근 불가
   - OWASP 권장 보안 패턴 적용

2. **자동 토큰 관리**
   - 브라우저가 자동으로 쿠키 첨부
   - 토큰 갱신 로직 서버 사이드 처리
   - CSRF 토큰과 결합하여 이중 보안

3. **세션 관리 개선**
   - 서버에서 토큰 만료 제어
   - 강제 로그아웃 기능 가능
   - 다중 기기 세션 관리

### 구현 내용
| 항목 | 변경 내용 |
|------|----------|
| 토큰 저장 | localStorage → httpOnly Cookie |
| 토큰 접근 | 직접 접근 → API 통한 간접 접근 |
| 인증 확인 | `/api/auth/me` 엔드포인트 사용 |
| 로그아웃 | 쿠키 삭제 API 호출 |

### 결정자
- Phase 1 보안 강화 계획에 따른 구현 (2026-02-04)

---

## [2026-02-02] 클라이언트 사이드 어드민 인증 (해결됨)

### 결정
어드민 인증을 클라이언트 사이드에서 처리 (하드코딩된 계정 목록)

### 근거 (당시)
1. **빠른 프로토타이핝**
   - 백엔드 API 없이 어드민 기능 개발
   - MVP 단계에서의 편의성

2. **개발 리소스 제약**
   - 어드민 전용 API 개발 시간 부족

### 문제점 (당시)
| 문제 | 심각도 |
|------|--------|
| 비밀번호 소스코드 노출 | Critical |
| localStorage에 인증 정보 저장 | Critical |
| 클라이언트 우회 가능 | Critical |

### 해결 (2026-02-04)
- ✅ JWT httpOnly Cookie 방식으로 전환 완료
- ✅ 하드코딩된 비밀번호 제거
- ✅ 서버 사이드 인증으로 전환

### 결정자
- 초기 개발 시 임시 결정 → Phase 1에서 해결

---

## 의사결정 작성 가이드

### 필수 항목
1. **결정**: 무엇을 결정했는가
2. **근거**: 왜 이렇게 결정했는가 (가장 중요!)
3. **기각된 대안**: 다른 선택지는 왜 기각했는가
4. **결정자**: 누가 승인했는가

### 작성 시점
- 아키텍처 변경 시
- 중요한 설계 결정 시
- 기존 방식을 변경할 때
- "왜 이렇게 되어 있지?"라는 질문이 예상될 때

---

**마지막 업데이트**: 2026-02-04
