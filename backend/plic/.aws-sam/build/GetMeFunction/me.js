"use strict";var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var h=(e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})},p=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of f(t))!g.call(e,i)&&i!==r&&l(e,i,{get:()=>t[i],enumerable:!(o=y(t,i))||o.enumerable});return e};var A=e=>p(l({},"__esModule",{value:!0}),e);var I={};h(I,{handler:()=>x});module.exports=A(I);var a=require("@aws-sdk/client-cognito-identity-provider"),c=require("@aws-sdk/client-dynamodb"),u=require("@aws-sdk/lib-dynamodb"),C=new a.CognitoIdentityProviderClient({region:"ap-northeast-2"}),T=new c.DynamoDBClient({region:"ap-northeast-2"}),w=u.DynamoDBDocumentClient.from(T),P="plic-users",d={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,Authorization","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS"};function m(e,t=200){return{statusCode:t,headers:d,body:JSON.stringify({success:!0,data:e})}}function s(e,t=400){return{statusCode:t,headers:d,body:JSON.stringify({success:!1,error:e})}}function E(e){return e?e.startsWith("Bearer ")?e.substring(7):e:null}async function b(e){let t=await C.send(new a.GetUserCommand({AccessToken:e})),r={};return t.UserAttributes?.forEach(o=>{o.Name&&o.Value&&(r[o.Name]=o.Value)}),{username:t.Username,email:r.email,name:r.name,phone:r.phone_number,emailVerified:r.email_verified==="true"}}var x=async e=>{if(e.httpMethod==="OPTIONS")return m({});try{let t=E(e.headers.Authorization||e.headers.authorization);if(!t)return s("\uC778\uC99D \uD1A0\uD070\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.",401);let r=await b(t);if(!r.email)return s("\uC720\uD6A8\uD558\uC9C0 \uC54A\uC740 \uD1A0\uD070\uC785\uB2C8\uB2E4.",401);let i=(await w.send(new u.QueryCommand({TableName:P,IndexName:"email-index",KeyConditionExpression:"email = :email",ExpressionAttributeValues:{":email":r.email}}))).Items||[];if(i.length===0)return s("\uC0AC\uC6A9\uC790\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",404);let n=i[0];return m({uid:n.uid,name:n.name,email:n.email,phone:n.phone,grade:n.grade,status:n.status,feeRate:n.feeRate,monthlyLimit:n.monthlyLimit,usedAmount:n.usedAmount,remainingLimit:n.monthlyLimit-n.usedAmount,isVerified:n.isVerified,agreements:n.agreements,totalPaymentAmount:n.totalPaymentAmount,totalDealCount:n.totalDealCount,createdAt:n.createdAt,lastLoginAt:n.lastLoginAt,userType:n.userType,businessInfo:n.businessInfo,authType:n.authType,socialProvider:n.socialProvider})}catch(t){return console.error("GetMe error:",t),t.name==="NotAuthorizedException"?s("\uD1A0\uD070\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uB85C\uADF8\uC778\uD574\uC8FC\uC138\uC694.",401):s("\uC11C\uBC84 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.",500)}};0&&(module.exports={handler});
//# sourceMappingURL=me.js.map
